<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Mikel Coffee - Çalışan Sistemi</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#8B4513">
    <link rel="icon" href="https://customer-assets.emergentagent.com/job_0f64345d-2f6b-41c8-af15-208e01ade896/artifacts/fwptedkg_M%C4%B0KEL%20LOGOSU.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #FAFAFA 0%, #F5F5F5 100%);
            color: #262626;
            line-height: 1.6;
            min-height: 100vh;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://customer-assets.emergentagent.com/job_0f64345d-2f6b-41c8-af15-208e01ade896/artifacts/fwptedkg_M%C4%B0KEL%20LOGOSU.png');
            background-size: 500px 500px;
            background-repeat: no-repeat;
            background-position: center center;
            opacity: 0.01;
            z-index: -1;
            pointer-events: none;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
            min-height: 100vh;
            position: relative;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        /* Header - Instagram style */
        .header {
            background: white;
            color: #262626;
            padding: 15px 20px;
            border-bottom: 1px solid #DBDBDB;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .brand-name {
            font-size: 20px;
            font-weight: 700;
            color: #262626;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logout-btn {
            background: none;
            border: none;
            color: #8E8E8E;
            font-size: 24px;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        
        .logout-btn:hover {
            color: #262626;
        }
        
        /* Notification Badge Styles */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #FF3040;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 11px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
        }
        
        #notificationBtn {
            position: relative;
        }

        /* Notification Styles */
        .notifications-container {
            max-height: 400px;
            overflow-y: auto;
        }

        .notification-item {
            padding: 15px;
            border-bottom: 1px solid #DBDBDB;
            cursor: pointer;
            position: relative;
            background: white;
            transition: background-color 0.2s ease;
        }

        .notification-item:hover {
            background: #FAFAFA;
        }

        .notification-item.unread {
            background: #F0F8FF;
            border-left: 3px solid #0095F6;
        }

        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .notification-title {
            font-weight: 600;
            color: #262626;
            font-size: 14px;
        }

        .notification-time {
            font-size: 12px;
            color: #8E8E8E;
        }

        .notification-message {
            color: #262626;
            font-size: 14px;
            line-height: 1.4;
        }

        .unread-dot {
            position: absolute;
            top: 15px;
            right: 10px;
            width: 8px;
            height: 8px;
            background: #0095F6;
            border-radius: 50%;
        }
        
        /* Auth Styles - Instagram inspired */
        .auth-container {
            background: white;
            margin: 40px 20px;
            padding: 40px 30px;
            border: 1px solid #DBDBDB;
            border-radius: 1px;
        }
        
        .auth-logo {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .auth-logo img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-bottom: 15px;
        }
        
        .auth-title {
            font-size: 24px;
            font-weight: 300;
            color: #262626;
            text-align: center;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #DBDBDB;
            margin-bottom: 30px;
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            border: none;
            background: none;
            font-size: 16px;
            color: #8E8E8E;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .tab.active {
            color: #262626;
            border-bottom-color: #262626;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #DBDBDB;
            border-radius: 3px;
            font-size: 14px;
            background: #FAFAFA;
            transition: border-color 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #A8A8A8;
            background: white;
        }
        
        .btn {
            width: 100%;
            padding: 12px;
            background: #0095F6;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .btn:hover {
            background: #1877F2;
        }
        
        .btn:disabled {
            background: #B2DFFC;
            cursor: not-allowed;
        }

        .btn-danger {
            background: #FF3040;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .btn-danger:hover {
            background: #FF1744;
        }
        
        /* Feed Styles - Instagram */
        .feed {
            padding-bottom: 80px;
        }
        
        .profile-section {
            background: white;
            padding: 20px;
            border-bottom: 1px solid #DBDBDB;
        }
        
        .profile-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(45deg, #F09433 0%, #E6683C 25%, #DC2743 50%, #CC2366 75%, #BC1888 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
            border: 3px solid white;
            box-shadow: 0 0 0 2px #DBDBDB;
        }
        
        .profile-info {
            flex: 1;
        }
        
        .profile-name {
            font-size: 18px;
            font-weight: 600;
            color: #262626;
            margin-bottom: 5px;
        }
        
        .profile-details {
            font-size: 14px;
            color: #8E8E8E;
            line-height: 1.4;
        }
        
        .profile-badges {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }
        
        .badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .admin-badge { background: #FF3040; color: white; }
        .edu-badge { background: #405DE6; color: white; }
        .employee-badge { background: #1BA1F2; color: white; }
        
        /* Post Styles */
        .post {
            background: white;
            border-bottom: 1px solid #DBDBDB;
            margin-bottom: 0;
        }
        
        .post-header {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .post-user {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .post-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(45deg, #F09433, #E6683C, #DC2743);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        
        .post-info {
            display: flex;
            flex-direction: column;
        }
        
        .post-username {
            font-size: 14px;
            font-weight: 600;
            color: #262626;
        }
        
        .post-time {
            font-size: 12px;
            color: #8E8E8E;
        }
        
        .post-menu {
            font-size: 16px;
            color: #8E8E8E;
            cursor: pointer;
        }
        
        .post-content {
            padding: 0 20px 15px 20px;
        }
        
        .post-title {
            font-size: 16px;
            font-weight: 600;
            color: #262626;
            margin-bottom: 8px;
            line-height: 1.4;
        }
        
        .post-text {
            font-size: 14px;
            color: #262626;
            line-height: 1.5;
        }
        
        .urgent-banner {
            background: linear-gradient(135deg, #FF3040, #FF1744);
            color: white;
            padding: 10px 20px;
            font-size: 12px;
            font-weight: 700;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .post-actions {
            padding: 15px 20px;
            border-top: 1px solid #EFEFEF;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .action-btn {
            background: none;
            border: none;
            font-size: 14px;
            color: #8E8E8E;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 20px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .action-btn:hover {
            background: #F5F5F5;
        }
        
        .like-btn.liked {
            color: #FF3040;
            background: #FFEBEE;
        }

        /* Social Feed Styles */
        .social-feed {
            padding: 20px;
        }

        .create-post-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #EFEFEF;
        }

        .post-actions-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }

        .btn-secondary {
            background: #F5F5F5;
            color: #8E8E8E;
            border: none;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
        }

        .social-post {
            background: white;
            border-radius: 15px;
            margin-bottom: 15px;
            border: 1px solid #EFEFEF;
            overflow: hidden;
        }

        .error-state {
            text-align: center;
            padding: 40px 20px;
            color: #8E8E8E;
        }

        /* Profile Styles */
        .profile-page {
            padding: 20px;
        }

        .profile-picture-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .profile-picture-large {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(45deg, #F09433, #E6683C);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            font-weight: bold;
            margin: 0 auto 15px;
            overflow: hidden;
        }

        .profile-info-section {
            space-y: 15px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #262626;
        }

        /* Instagram-Style Profile Styles */
        .instagram-profile {
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        .profile-header-section {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #EFEFEF;
        }

        .profile-image-container {
            flex-shrink: 0;
        }

        .profile-picture-instagram {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(45deg, #F09433, #E6683C);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            font-weight: bold;
            overflow: hidden;
            cursor: pointer;
        }

        .profile-info-instagram {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .profile-name-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .profile-username {
            font-size: 28px;
            font-weight: 300;
            color: #262626;
            margin: 0;
        }

        .edit-profile-btn {
            background: none;
            border: 1px solid #DBDBDB;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            color: #262626;
        }

        .profile-stats {
            display: flex;
            gap: 40px;
        }

        .stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
        }

        .stat-number {
            font-size: 18px;
            font-weight: 600;
            color: #262626;
        }

        .stat-label {
            font-size: 14px;
            color: #8E8E8E;
        }

        .profile-bio {
            font-size: 14px;
            line-height: 1.5;
            color: #262626;
        }

        .profile-content-tabs {
            display: flex;
            border-top: 1px solid #EFEFEF;
            margin-bottom: 20px;
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            border-top: 1px solid transparent;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            color: #8E8E8E;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .tab.active {
            color: #262626;
            border-top-color: #262626;
        }

        .posts-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4px;
        }

        .post-grid-item {
            aspect-ratio: 1;
            background: #F5F5F5;
            border-radius: 4px;
            cursor: pointer;
            overflow: hidden;
            position: relative;
        }

        .post-grid-content {
            padding: 10px;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .post-grid-stats {
            display: flex;
            gap: 10px;
            font-size: 12px;
            color: #8E8E8E;
        }

        .empty-posts {
            text-align: center;
            padding: 60px 20px;
            color: #8E8E8E;
        }

        .empty-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .empty-text {
            font-size: 16px;
            font-weight: 600;
        }

        /* Social Feed Layout */
        .feed-container {
            display: flex;
            max-width: 1200px;
            margin: 0 auto;
            gap: 20px;
        }

        .main-feed {
            flex: 1;
            max-width: 700px;
        }

        .sidebar {
            width: 300px;
            padding: 20px;
        }

        .sidebar-section h3 {
            font-size: 16px;
            font-weight: 600;
            color: #262626;
            margin-bottom: 15px;
        }

        .user-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 0;
            cursor: pointer;
            border-radius: 8px;
            transition: background 0.2s;
        }

        .user-item:hover {
            background: #F5F5F5;
        }

        .user-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(45deg, #F09433, #E6683C);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            overflow: hidden;
        }

        .user-info {
            flex: 1;
        }

        .user-name {
            font-size: 14px;
            font-weight: 600;
            color: #262626;
        }

        .user-position {
            font-size: 12px;
            color: #8E8E8E;
        }

        .user-stats {
            font-size: 12px;
            color: #8E8E8E;
        }

        .user-actions {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Comments System Styles */
        .comments-section {
            padding: 20px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .add-comment {
            border-bottom: 1px solid #EFEFEF;
            padding-bottom: 20px;
            margin-bottom: 20px;
        }

        .comment-input-container {
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        .user-avatar-small {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(45deg, #F09433, #E6683C);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            overflow: hidden;
            flex-shrink: 0;
        }

        .comment-input-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .comment-input {
            width: 100%;
            border: 1px solid #DBDBDB;
            border-radius: 20px;
            padding: 12px 16px;
            font-size: 14px;
            resize: vertical;
            min-height: 40px;
            max-height: 120px;
            font-family: inherit;
        }

        .comment-input:focus {
            outline: none;
            border-color: #405DE6;
        }

        .comment-send-btn {
            align-self: flex-end;
            background: linear-gradient(45deg, #F09433, #E6683C);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.3s;
        }

        .comment-send-btn:hover {
            opacity: 0.9;
        }

        .comments-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .comment-item {
            display: flex;
            gap: 12px;
            align-items: flex-start;
        }

        .comment-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(45deg, #F09433, #E6683C);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            overflow: hidden;
            flex-shrink: 0;
        }

        .comment-content {
            flex: 1;
            background: #F5F5F5;
            border-radius: 16px;
            padding: 12px 16px;
        }

        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .comment-author {
            font-size: 13px;
            font-weight: 600;
            color: #262626;
        }

        .comment-time {
            font-size: 11px;
            color: #8E8E8E;
        }

        .comment-text {
            font-size: 14px;
            color: #262626;
            line-height: 1.4;
        }

        .share-btn {
            color: #1877F2 !important;
        }

        .share-btn:hover {
            background: #E7F3FF !important;
        }

        .create-post-section {
            display: flex;
            gap: 12px;
            padding: 20px;
            background: white;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 1px solid #EFEFEF;
        }

        .create-post-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #F09433, #E6683C);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            overflow: hidden;
            flex-shrink: 0;
        }

        .create-post-input {
            flex: 1;
        }

        .avatar-initials {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #F09433, #E6683C);
            color: white;
            font-weight: bold;
            border-radius: 50%;
        }

        .post-user {
            cursor: pointer;
        }

        /* Media Styles */
        .media-preview-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 10px;
            background: #F5F5F5;
            border-radius: 8px;
        }

        .media-type {
            font-size: 12px;
            color: #8E8E8E;
            font-weight: 600;
        }

        .media-upload-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .post-media {
            margin-top: 15px;
        }

        .delete-btn {
            color: #FF3040 !important;
        }

        .delete-btn:hover {
            background: #FFEBEE !important;
        }

        .edit-btn {
            color: #0095F6 !important;
        }

        .edit-btn:hover {
            background: #E3F2FD !important;
        }

        .admin-btn {
            color: #FFD700 !important;
        }

        .admin-btn:hover {
            background: #FFFACD !important;
        }

        /* Files Section Styles */
        .files-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #DBDBDB;
            background: white;
        }

        .files-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .files-icon {
            font-size: 24px;
        }

        .files-text {
            font-size: 20px;
            font-weight: 600;
            color: #262626;
        }

        .upload-btn {
            background: #0095F6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 14px;
        }

        .upload-btn:hover {
            background: #0081D8;
        }

        .files-categories {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            padding: 20px;
            background: white;
        }

        .category-item {
            background: #FAFAFA;
            border: 1px solid #DBDBDB;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none; /* Metni seçilmez yap */
        }

        .category-item:hover {
            background: #F0F0F0;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .category-icon {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .category-title {
            font-size: 16px;
            font-weight: 600;
            color: #262626;
            margin-bottom: 5px;
        }

        .category-count {
            font-size: 14px;
            color: #8E8E8E;
            font-weight: 500;
        }

        .files-welcome {
            text-align: center;
            padding: 60px 20px;
            color: #8E8E8E;
        }

        .welcome-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .welcome-text h3 {
            color: #262626;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .welcome-text p {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .files-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            padding: 20px;
        }

        .file-item {
            background: white;
            border: 1px solid #DBDBDB;
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s ease;
        }

        .file-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .file-preview {
            height: 150px;
            background: #FAFAFA;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
        }

        .file-info {
            padding: 12px;
        }

        .file-title {
            font-weight: 600;
            color: #262626;
            margin-bottom: 4px;
            font-size: 14px;
        }

        .file-meta {
            font-size: 12px;
            color: #8E8E8E;
            margin-bottom: 8px;
        }

        .file-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-like-btn {
            background: none;
            border: none;
            color: #8E8E8E;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 14px;
        }

        .file-like-btn.liked {
            color: #FF3040;
        }

        .file-download-btn {
            background: none;
            border: none;
            color: #0095F6;
            cursor: pointer;
            font-size: 16px;
        }

        .file-edit-btn {
            background: none;
            border: none;
            color: #0095F6;
            cursor: pointer;
            font-size: 16px;
            transition: opacity 0.3s ease;
            display: inline-block !important;
            visibility: visible !important;
        }

        .file-edit-btn:hover {
            opacity: 0.7;
        }

        .file-delete-btn {
            background: none;
            border: none;
            color: #FF3040;
            cursor: pointer;
            font-size: 16px;
            transition: opacity 0.3s ease;
            display: inline-block !important;
            visibility: visible !important;
        }

        .file-delete-btn:hover {
            opacity: 0.7;
        }

        .profile-picture-edit {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(45deg, #F09433, #E6683C);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: bold;
            margin: 0 auto 15px;
            overflow: hidden;
        }

        .edit-profile-form {
            padding: 20px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .form-actions {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #EFEFEF;
        }

        .form-actions button {
            flex: 1;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .feed-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                order: -1;
            }
            
            .profile-header-section {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            
            .profile-picture-instagram {
                width: 120px;
                height: 120px;
            }

            .media-upload-buttons {
                flex-direction: column;
            }
        }
        
        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 400px;
            background: white;
            border-top: 1px solid #DBDBDB;
            padding: 8px 0;
            display: flex;
            justify-content: space-around;
            z-index: 1000;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 12px;
            cursor: pointer;
            text-decoration: none;
            color: #8E8E8E;
            transition: color 0.3s ease;
        }
        
        .nav-item.active {
            color: #262626;
        }
        
        .nav-icon {
            font-size: 24px;
            margin-bottom: 2px;
        }
        
        .nav-label {
            font-size: 10px;
            font-weight: 500;
        }
        
        /* Create Post Button */
        .create-post-btn {
            position: fixed;
            bottom: 90px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: linear-gradient(45deg, #F09433, #E6683C, #DC2743);
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(220, 39, 67, 0.4);
            transition: transform 0.3s ease;
            z-index: 1001;
        }
        
        .create-post-btn:hover {
            transform: scale(1.1);
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.65);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            pointer-events: auto;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            width: 100%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
            pointer-events: auto;
        }
        
        .modal-header {
            padding: 20px 20px 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #DBDBDB;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #262626;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 18px;
            color: #8E8E8E;
            cursor: pointer;
        }
        
        .modal-body {
            padding: 0 20px 20px 20px;
        }
        
        /* Excel Button */
        .excel-btn {
            background: #107C41;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 10px 0;
            transition: background 0.3s ease;
            width: 100%;
            justify-content: center;
        }
        
        .excel-btn:hover {
            background: #0F5F31;
        }
        
        /* User List */
        .user-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 15px 0;
            border-bottom: 1px solid #EFEFEF;
        }
        
        .user-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(45deg, #F09433, #E6683C, #DC2743);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            font-weight: bold;
        }
        
        .user-info {
            flex: 1;
        }
        
        .user-name {
            font-size: 14px;
            font-weight: 600;
            color: #262626;
            margin-bottom: 2px;
        }
        
        .user-details {
            font-size: 12px;
            color: #8E8E8E;
        }
        
        /* Empty States */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #8E8E8E;
        }
        
        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
        
        .empty-text {
            font-size: 18px;
            font-weight: 300;
            margin-bottom: 8px;
        }
        
        .empty-subtext {
            font-size: 14px;
        }
        
        /* Position Picker */
        .position-list {
            background: #FAFAFA;
            border: 1px solid #DBDBDB;
            border-radius: 3px;
            margin-top: 5px;
        }
        
        .position-item {
            padding: 12px 15px;
            border-bottom: 1px solid #EFEFEF;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s ease;
        }
        
        .position-item:hover {
            background: white;
        }
        
        .position-item:last-child {
            border-bottom: none;
        }
        
        .position-item.selected {
            background: #0095F6;
            color: white;
        }
        
        /* Messages */
        .message {
            padding: 12px 16px;
            border-radius: 6px;
            margin: 15px 0;
            font-size: 14px;
            font-weight: 500;
        }
        
        .success {
            background: #D4F6DD;
            color: #155724;
            border: 1px solid #C3E6CB;
        }
        
        .error {
            background: #F8D7DA;
            color: #721C24;
            border: 1px solid #F5C6CB;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: #8E8E8E;
        }
        
        .loading-spinner {
            width: 32px;
            height: 32px;
            border: 3px solid #DBDBDB;
            border-top: 3px solid #0095F6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Form specific styles */
        textarea.form-control {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }
        
        .char-count {
            text-align: right;
            font-size: 11px;
            color: #8E8E8E;
            margin-top: 5px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 15px 0;
        }
        
        .checkbox-group input[type="checkbox"] {
            transform: scale(1.2);
        }
        
        .checkbox-group label {
            font-size: 14px;
            color: #262626;
        }
        
        /* Responsive */
        @media (max-width: 480px) {
            .container {
                box-shadow: none;
            }
            
            .auth-container {
                margin: 20px 15px;
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="app">
        <!-- App content will be loaded here -->
    </div>

    <script>
        // Backend URL konfigürasyonu - Demo Mode
        const BACKEND_URL = window.location.hostname.includes('localhost') 
            ? 'http://localhost:8001' 
            : 'https://employee-hub-45.preview.emergentagent.com'; // Demo backend
        
        console.log('🔧 BACKEND_URL configured as:', BACKEND_URL);
        
        let currentUser = null;
        let announcements = [];
        let socialPosts = [];
        let userMap_global = {};
        let isLoginMode = true;
        let selectedPosition = '';

        // PWA Install Prompt
        let deferredPrompt;
        let installButton = null;

        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent the mini-infobar from appearing on mobile
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;
            // Update UI notify the user they can install the PWA
            showInstallPromotion();
        });

        function showInstallPromotion() {
            // Show install button in header
            if (!installButton) {
                installButton = document.createElement('button');
                installButton.className = 'logout-btn';
                installButton.innerHTML = '📱';
                installButton.title = 'Uygulamayı Yükle';  
                installButton.onclick = installPWA;
                
                // Add to header actions
                const headerActions = document.querySelector('.header-actions');
                if (headerActions) {
                    headerActions.insertBefore(installButton, headerActions.firstChild);
                }
            }
        }

        async function installPWA() {
            if (!deferredPrompt) {
                alert('Uygulama zaten yüklü veya tarayıcınız desteklemiyor');
                return;
            }

            // Show the install prompt
            deferredPrompt.prompt();
            
            // Wait for the user to respond to the prompt
            const { outcome } = await deferredPrompt.userChoice;
            
            if (outcome === 'accepted') {
                console.log('✅ PWA installed successfully');
                // Hide the install button
                if (installButton) {
                    installButton.style.display = 'none';
                }
            } else {
                console.log('❌ User dismissed the install prompt');
            }
            
            // Clear the deferredPrompt
            deferredPrompt = null;
        }

        // Check if PWA is already installed
        window.addEventListener('appinstalled', () => {
            console.log('✅ PWA was installed');
            if (installButton) {
                installButton.style.display = 'none';
            }
        });

        // Enhanced Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const registration = await navigator.serviceWorker.register('/sw.js');
                    console.log('✅ Service Worker registered:', registration);
                    
                    // Check for updates
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed') {
                                if (navigator.serviceWorker.controller) {
                                    // New update available
                                    showUpdateAvailable();
                                }
                            }
                        });
                    });
                } catch (error) {
                    console.error('❌ Service Worker registration failed:', error);
                }
            });
        }

        function showUpdateAvailable() {
            if (confirm('Yeni güncelleme mevcut! Yeniden yüklemek ister misiniz?')) {
                window.location.reload();
            }
        }

        // Global function to load users with profiles
        async function loadUsersWithProfiles() {
            try {
                const token = localStorage.getItem('auth_token');
                console.log('🔍 LOADING USERS WITH PROFILES...');

                // Load users first
                const usersResponse = await fetch(`${BACKEND_URL}/api/users`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!usersResponse.ok) {
                    console.error('❌ Failed to load users');
                    return;
                }

                const users = await usersResponse.json();
                console.log('✅ Users loaded:', users.length);

                // Load profiles
                const profilesResponse = await fetch(`${BACKEND_URL}/api/profiles`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!profilesResponse.ok) {
                    console.error('❌ Failed to load profiles');
                    return;
                }

                const profiles = await profilesResponse.json();
                console.log('✅ Profiles loaded:', profiles.length);

                // Create user map with profile data
                userMap_global = {};
                
                // First, add all users to the map
                users.forEach(user => {
                    userMap_global[user.employee_id] = {
                        employee_id: user.employee_id,
                        name: user.name,
                        surname: user.surname,
                        email: user.email,
                        position: user.position,
                        store: user.store,
                        is_admin: user.is_admin,
                        special_role: user.special_role,
                        profile_image_url: null // Default to null
                    };
                });

                // Then, add profile data where available
                profiles.forEach(profile => {
                    if (userMap_global[profile.user_id]) {
                        userMap_global[profile.user_id].profile_image_url = profile.profile_image_url;
                        userMap_global[profile.user_id].bio = profile.bio;
                        console.log(`✅ Profile photo found for user ${profile.user_id}:`, profile.profile_image_url ? 'YES' : 'NO');
                    }
                });

                console.log('✅ UserMap created with', Object.keys(userMap_global).length, 'users');
                console.log('🔍 UserMap sample:', Object.values(userMap_global).slice(0, 3));

                // Force re-render posts if they exist
                if (typeof announcements !== 'undefined' && announcements.length > 0) {
                    console.log('🔄 Re-rendering posts with profile photos...');
                    const postsContainer = document.getElementById('postsContainer');
                    if (postsContainer) {
                        postsContainer.innerHTML = renderPosts();
                    }
                }

            } catch (error) {
                console.error('❌ Error in loadUsersWithProfiles:', error);
            }
        }

        // Initialize app
        window.onload = function() {
            checkAuthStatus();
        };

        async function checkAuthStatus() {
            const token = localStorage.getItem('auth_token');
            const userData = localStorage.getItem('user');
            
            if (token && userData) {
                try {
                    currentUser = JSON.parse(userData);
                    await loadFeed();
                } catch (error) {
                    console.error('Auth error:', error);
                    showAuthForm();
                }
            } else {
                showAuthForm();
            }
        }

        function showAuthForm() {
            document.getElementById('app').innerHTML = `
                <div class="auth-container">
                    <div class="auth-logo">
                        <img src="https://customer-assets.emergentagent.com/job_0f64345d-2f6b-41c8-af15-208e01ade896/artifacts/fwptedkg_M%C4%B0KEL%20LOGOSU.png" 
                             alt="Mikel Coffee">
                        <div class="auth-title">Mikel Coffee</div>
                    </div>

                    <div class="tabs">
                        <button class="tab active" onclick="switchTab('login')">Giriş Yap</button>
                        <button class="tab" onclick="switchTab('register')">Kayıt Ol</button>
                    </div>

                    <form id="authForm">
                        <div id="registerFields" style="display: none;">
                            <div class="form-group">
                                <input type="text" class="form-control" id="name" placeholder="Ad" autocomplete="given-name">
                            </div>
                            <div class="form-group">
                                <input type="text" class="form-control" id="surname" placeholder="Soyad" autocomplete="family-name">
                            </div>
                            <div class="form-group">
                                <input type="date" class="form-control" id="startDate" placeholder="İşe Giriş Tarihi">
                                <label for="startDate" style="font-size: 12px; color: #8E8E8E; margin-top: 2px;">İşe Giriş Tarihi</label>
                            </div>
                            <div class="form-group">
                                <input type="text" class="form-control" id="store" placeholder="Mağaza (isteğe bağlı)">
                            </div>
                            <div class="form-group">
                                <input type="text" class="form-control" id="position" placeholder="Pozisyon seçin" readonly onclick="togglePositions()">
                                <div class="position-list" id="positionList" style="display:none;">
                                    <div class="position-item" onclick="selectPosition('servis personeli')">Servis Personeli</div>
                                    <div class="position-item" onclick="selectPosition('barista')">Barista</div>
                                    <div class="position-item" onclick="selectPosition('supervizer')">Supervizer</div>
                                    <div class="position-item" onclick="selectPosition('müdür yardımcısı')">Müdür Yardımcısı</div>
                                    <div class="position-item" onclick="selectPosition('mağaza müdürü')">Mağaza Müdürü</div>
                                    <div class="position-item" onclick="selectPosition('trainer')">Trainer</div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <input type="email" class="form-control" id="email" placeholder="E-posta" required autocomplete="email">
                        </div>
                        
                        <div class="form-group">
                            <input type="password" class="form-control" id="password" placeholder="Şifre" required autocomplete="current-password">
                        </div>

                        <button type="submit" class="btn" id="submitBtn">Giriş Yap</button>
                        <div id="message"></div>
                    </form>
                </div>
            `;

            document.getElementById('authForm').addEventListener('submit', handleAuth);
        }

        function switchTab(mode) {
            isLoginMode = (mode === 'login');
            const tabs = document.querySelectorAll('.tab');
            const registerFields = document.getElementById('registerFields');
            const submitBtn = document.getElementById('submitBtn');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            if (isLoginMode) {
                registerFields.style.display = 'none';
                submitBtn.textContent = 'Giriş Yap';
            } else {
                registerFields.style.display = 'block';
                submitBtn.textContent = 'Kayıt Ol';
            }
        }

        function togglePositions() {
            const positionList = document.getElementById('positionList');
            positionList.style.display = positionList.style.display === 'none' ? 'block' : 'none';
        }

        function selectPosition(position) {
            selectedPosition = position;
            document.getElementById('position').value = position.charAt(0).toUpperCase() + position.slice(1);
            document.getElementById('positionList').style.display = 'none';
        }

        async function handleAuth(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;
            
            if (!email || !password) {
                showMessage('E-posta ve şifre gereklidir', 'error');
                return;
            }
            
            if (!isLoginMode) {
                const name = document.getElementById('name').value.trim();
                const surname = document.getElementById('surname').value.trim();
                const startDate = document.getElementById('startDate').value;
                
                if (!name || !surname || !selectedPosition || !startDate) {
                    showMessage('Ad, soyad, pozisyon ve işe giriş tarihi gereklidir', 'error');
                    return;
                }
            }
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Gönderiliyor...';
            
            try {
                const endpoint = isLoginMode ? 'login' : 'register';
                const body = isLoginMode 
                    ? { email: email.toLowerCase(), password }
                    : {
                        email: email.toLowerCase(),
                        password,
                        name: document.getElementById('name').value.trim(),
                        surname: document.getElementById('surname').value.trim(),
                        position: selectedPosition,
                        store: document.getElementById('store').value.trim() || null,
                        start_date: document.getElementById('startDate').value
                    };

                const response = await fetch(`${BACKEND_URL}/api/auth/${endpoint}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });

                const data = await response.json();

                if (response.ok) {
                    localStorage.setItem('auth_token', data.access_token);
                    localStorage.setItem('user', JSON.stringify(data.user));
                    currentUser = data.user;
                    
                    // Debugging
                    console.log('✅ Login successful, user:', currentUser.name);
                    console.log('✅ Token saved, loading dashboard...');
                    
                    showMessage(isLoginMode 
                        ? `Hoş geldiniz!`
                        : `Kayıt başarılı! Sicil: ${data.user.employee_id}`, 'success');
                    
                    // Clear login form
                    document.getElementById('app').innerHTML = '<div style="text-align:center;padding:50px;"><div style="font-size:24px;">📱 Yükleniyor...</div></div>';
                    
                    setTimeout(() => {
                        console.log('Loading feed...');
                        
                        // Ensure currentUser is loaded from localStorage
                        const savedUserData = localStorage.getItem('user');
                        if (savedUserData) {
                            currentUser = JSON.parse(savedUserData);
                            console.log('🔧 CURRENT USER RELOADED FROM LOCALSTORAGE:', currentUser);
                            console.log('🔧 IS ADMIN:', currentUser.is_admin);
                        }
                        
                        // Push notification'ı tamamen kaldırıyoruz - hata vermesin
                        // initializePushNotifications(); 
                        loadFeed();
                    }, 1000); // 1 saniye bekle - şüpheli timing sorunu için
                } else {
                    showMessage(data.detail || 'Bir hata oluştu', 'error');
                }
            } catch (error) {
                showMessage('Bağlantı hatası', 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = isLoginMode ? 'Giriş Yap' : 'Kayıt Ol';
            }
        }

        async function loadFeed() {
            // Ensure currentUser is loaded before proceeding
            if (!currentUser) {
                const savedUserData = localStorage.getItem('user');
                if (savedUserData) {
                    currentUser = JSON.parse(savedUserData);
                    console.log('🔧 LOADFEED - Current user reloaded from localStorage:', currentUser);
                }
            }
            
            if (!currentUser) {
                console.error('❌ LOADFEED - No current user available');
                showAuthForm();
                return;
            }
            
            console.log('🔧 LOADFEED - Current user confirmed:', currentUser.name, 'Admin:', currentUser.is_admin);
            
            await loadAnnouncements();
            await loadUsersWithProfiles(); // Ana sayfada profil fotoğrafları için
            await updateNotificationCount(); // Bildirim sayısını güncelle
            
            const userInitials = (currentUser.name?.[0] || '') + (currentUser.surname?.[0] || '');
            const canPost = currentUser.is_admin || currentUser.position === 'trainer' || currentUser.special_role === 'eğitim departmanı';
            
            document.getElementById('app').innerHTML = `
                <div class="header">
                    <div class="header-content">
                        <div class="logo-section">
                            <img src="https://customer-assets.emergentagent.com/job_0f64345d-2f6b-41c8-af15-208e01ade896/artifacts/fwptedkg_M%C4%B0KEL%20LOGOSU.png" 
                                 alt="Mikel Coffee" class="logo">
                            <div class="brand-name">Mikel Coffee</div>
                        </div>
                        <div class="header-actions">
                            <button class="logout-btn" onclick="showProfile()" title="Profil">👤</button>
                            <button class="logout-btn" onclick="logout()" title="Çıkış">🚪</button>
                        </div>
                    </div>
                </div>

                <div class="feed">
                    <div class="profile-section">
                        <div class="profile-header">
                            <div class="profile-avatar">${userInitials}</div>
                            <div class="profile-info">
                                <div class="profile-name">${currentUser.name} ${currentUser.surname}</div>
                                <div class="profile-details">
                                    🏷️ ${currentUser.employee_id} • 💼 ${currentUser.position?.charAt(0).toUpperCase() + currentUser.position?.slice(1)}
                                    ${currentUser.store ? ` • 🏪 ${currentUser.store}` : ''}
                                </div>
                                <div class="profile-badges">
                                    ${currentUser.is_admin ? '<span class="badge admin-badge">Admin</span>' : ''}
                                    ${currentUser.special_role ? '<span class="badge edu-badge">Eğitim</span>' : ''}
                                    ${!currentUser.is_admin && !currentUser.special_role ? '<span class="badge employee-badge">Çalışan</span>' : ''}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="postsContainer">
                        ${renderPosts()}
                    </div>
                </div>

                ${canPost ? '<button class="create-post-btn" onclick="showCreatePost()">+</button>' : ''}

                <div class="bottom-nav">
                    <div class="nav-item active" onclick="showFeed()">
                        <div class="nav-icon">🏠</div>
                        <div class="nav-label">Ana Sayfa</div>
                    </div>
                    <div class="nav-item" onclick="showSocialFeed()">
                        <div class="nav-icon">📁</div>
                        <div class="nav-label">Dosyalar</div>
                    </div>
                    <div class="nav-item" onclick="showExamResults()">
                        <div class="nav-icon">📊</div>
                        <div class="nav-label">Sınavlar</div>
                    </div>
                    ${(currentUser.position === 'barista' || currentUser.position === 'supervizer') ? `
                    <div class="nav-item" onclick="showManagementExam()">
                        <div class="nav-icon">🎯</div>
                        <div class="nav-label">Yönetim</div>
                    </div>
                    ` : ''}
                    ${canPost ? `
                    <div class="nav-item" onclick="showExamEntry()">
                        <div class="nav-icon">📝</div>
                        <div class="nav-label">Sınav</div>
                    </div>
                    ` : ''}
                    ${(currentUser.is_admin || currentUser.special_role === 'eğitim departmanı') ? `
                    <div class="nav-item" onclick="showUserManagement()">
                        <div class="nav-icon">👥</div>
                        <div class="nav-label">Çalışanlar</div>
                    </div>
                    ` : ''}
                </div>

                <div id="modalOverlay" class="modal-overlay" style="display: none;">
                    <div class="modal-content" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <div class="modal-title" id="modalTitle"></div>
                            <button onclick="closeModal()" class="close-btn">✕</button>
                        </div>
                        <div id="modalBody" class="modal-body"></div>
                    </div>
                </div>
            `;
        }

        async function loadAnnouncements() {
            try {
                const token = localStorage.getItem('auth_token');
                const [announcementsResponse, usersLoaded] = await Promise.all([
                    fetch(`${BACKEND_URL}/api/announcements`, {
                        headers: { 'Authorization': `Bearer ${token}` }
                    }),
                    loadUsersWithProfiles()
                ]);
                
                if (announcementsResponse.ok) {
                    announcements = await announcementsResponse.json();
                }
            } catch (error) {
                console.error('Error loading announcements:', error);
            }
        }

        function renderPosts() {
            if (announcements.length === 0) {
                return `
                    <div class="empty-state">
                        <div class="empty-icon">📢</div>
                        <div class="empty-text">Henüz duyuru yok</div>
                        <div class="empty-subtext">İlk duyuru için beklemede kalın!</div>
                    </div>
                `;
            }

            return announcements.map(announcement => {
                const timeAgo = getTimeAgo(announcement.created_at);
                const author = userMap_global[announcement.created_by];
                const authorName = author ? `${author.name} ${author.surname}` : `Sicil: ${announcement.created_by}`;
                const authorInitials = author ? 
                    (author.name?.[0] || '') + (author.surname?.[0] || '') : 
                    (announcement.created_by ? announcement.created_by.slice(-2) : '??');
                
                // Simple debug logging (no loops)
                const hasProfilePhoto = author && author.profile_image_url;
                if (hasProfilePhoto) {
                    console.log(`✅ Rendering profile photo for ${announcement.created_by}`);
                } else {
                    console.log(`⭕ No profile photo for ${announcement.created_by}, using initials: ${authorInitials}`);
                }
                
                return `
                    <div class="post">
                        ${announcement.is_urgent ? '<div class="urgent-banner">🔴 ACİL DUYURU</div>' : ''}
                        <div class="post-header">
                            <div class="post-user" onclick="showProfile('${announcement.created_by}')">
                                <div class="post-avatar">
                                    ${hasProfilePhoto ? 
                                        `<img src="${author.profile_image_url}" alt="Profil" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">` : 
                                        `<div class="avatar-initials">${authorInitials}</div>`
                                    }
                                </div>
                                <div class="post-info">
                                    <div class="post-username">${authorName}</div>
                                    <div class="post-time">${timeAgo}</div>
                                </div>
                            </div>
                            <div class="post-menu">⋯</div>
                        </div>
                        <div class="post-content">
                            <div class="post-title">${announcement.title}</div>
                            <div class="post-text">${announcement.content}</div>
                            ${announcement.image_url ? `
                                <div class="post-media">
                                    ${announcement.image_url.startsWith('data:video/') ? 
                                        `<video src="${announcement.image_url}" controls style="width:100%;max-height:400px;border-radius:8px;margin-top:10px;"></video>` :
                                        `<img src="${announcement.image_url}" alt="Announcement media" style="width:100%;max-height:400px;object-fit:cover;border-radius:8px;margin-top:10px;">`
                                    }
                                </div>
                            ` : ''}
                        </div>
                        <div class="post-actions">
                            <button class="action-btn like-btn" onclick="toggleAnnouncementLike('${announcement._id || announcement.id}')">
                                ❤️ ${announcement.likes_count || 0}
                            </button>
                            ${(currentUser.is_admin || currentUser.special_role === 'eğitim departmanı' || announcement.created_by === currentUser.employee_id) ? `
                                <button class="action-btn delete-btn" onclick="deleteAnnouncement('${announcement._id || announcement.id}')" title="Sil">
                                    🗑️
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getTimeAgo(dateString) {
            const now = new Date();
            const date = new Date(dateString);
            const diffInMinutes = Math.floor((now - date) / (1000 * 60));
            
            if (diffInMinutes < 1) return 'az önce';
            if (diffInMinutes < 60) return `${diffInMinutes}dk`;
            
            const diffInHours = Math.floor(diffInMinutes / 60);
            if (diffInHours < 24) return `${diffInHours}sa`;
            
            const diffInDays = Math.floor(diffInHours / 24);
            if (diffInDays < 7) return `${diffInDays}g`;
            
            return date.toLocaleDateString('tr-TR', { day: 'numeric', month: 'short' });
        }

        // Navigation Functions
        function showFeed() {
            loadFeed();
        }

        function showNotifications() {
            loadNotifications();
        }

        async function loadNotifications() {
            try {
                const token = localStorage.getItem('auth_token');
                const response = await fetch(`${BACKEND_URL}/api/notifications`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const notifications = await response.json();
                    displayNotifications(notifications);
                } else {
                    displayNotifications([]);
                }
            } catch (error) {
                console.error('Error loading notifications:', error);
                displayNotifications([]);
            }
        }

        function displayNotifications(notifications) {
            document.getElementById('modalTitle').textContent = 'Bildirimler';
            
            if (notifications.length === 0) {
                document.getElementById('modalBody').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">🔔</div>
                        <div class="empty-text">Henüz bildirim yok</div>
                        <div class="empty-subtext">Yeni bildirimler burada görünecek</div>
                    </div>
                `;
            } else {
                const notificationsList = notifications.map(notification => `
                    <div class="notification-item ${notification.read ? '' : 'unread'}" onclick="markAsRead('${notification.id}')">
                        <div class="notification-header">
                            <div class="notification-title">${notification.title}</div>
                            <div class="notification-time">${formatDate(notification.created_at)}</div>
                        </div>
                        <div class="notification-message">${notification.message}</div>
                        ${!notification.read ? '<div class="unread-dot"></div>' : ''}
                    </div>
                `).join('');

                document.getElementById('modalBody').innerHTML = `
                    <div class="notifications-container">
                        ${notificationsList}
                    </div>
                `;
            }
            
            document.getElementById('modalOverlay').style.display = 'flex';
            
            // Reset notification badge
            const badge = document.getElementById('notificationBadge');
            if (badge) {
                badge.style.display = 'none';
                badge.textContent = '0';
            }
        }

        async function markAsRead(notificationId) {
            try {
                const token = localStorage.getItem('auth_token');
                await fetch(`${BACKEND_URL}/api/notifications/${notificationId}/read`, {
                    method: 'PUT',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                // Refresh notifications
                loadNotifications();
                updateNotificationCount();
            } catch (error) {
                console.error('Error marking notification as read:', error);
            }
        }

        async function updateNotificationCount() {
            try {
                const token = localStorage.getItem('auth_token');
                const response = await fetch(`${BACKEND_URL}/api/notifications/unread-count`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    const badge = document.getElementById('notificationBadge');
                    
                    if (data.unread_count > 0) {
                        badge.textContent = data.unread_count;
                        badge.style.display = 'flex';
                    } else {
                        badge.style.display = 'none';
                    }
                }
            } catch (error) {
                console.error('Error updating notification count:', error);
            }
        }

        function showCreatePost() {
            document.getElementById('modalTitle').textContent = 'Yeni Duyuru';
            document.getElementById('modalBody').innerHTML = `
                <form id="postForm">
                    <div class="form-group">
                        <input type="text" class="form-control" id="postTitle" placeholder="Başlık..." maxlength="100" required>
                    </div>
                    <div class="form-group">
                        <textarea class="form-control" id="postContent" placeholder="Ne paylaşmak istiyorsunuz?" maxlength="500" required></textarea>
                        <div class="char-count" id="charCount">0/500</div>
                    </div>
                    <div class="form-group">
                        <label>Medya Ekle</label>
                        <div id="announcementMediaPreview" style="display:none; margin:10px 0;"></div>
                        <div class="media-upload-buttons">
                            <input type="file" id="announcementMediaUpload" accept="image/*,video/*" style="display:none" onchange="handleAnnouncementMediaUpload(event)">
                            <button type="button" class="btn-secondary" onclick="document.getElementById('announcementMediaUpload').click()">📷 Medya Ekle</button>
                            <button type="button" class="btn-secondary" onclick="clearAnnouncementMedia()">❌ Temizle</button>
                        </div>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="isUrgent">
                        <label for="isUrgent">🔴 Acil duyuru</label>
                    </div>
                    <button type="submit" class="btn">Paylaş</button>
                </form>
            `;
            
            document.getElementById('postContent').addEventListener('input', updateCharCount);
            document.getElementById('postForm').addEventListener('submit', createPost);
            document.getElementById('modalOverlay').style.display = 'flex';
        }

        function updateCharCount() {
            const content = document.getElementById('postContent').value;
            document.getElementById('charCount').textContent = `${content.length}/500`;
        }

        async function createPost(e) {
            e.preventDefault();
            
            const title = document.getElementById('postTitle').value.trim();
            const content = document.getElementById('postContent').value.trim();
            const isUrgent = document.getElementById('isUrgent').checked;
            
            if (!title || !content) {
                showMessage('Başlık ve içerik gereklidir', 'error');
                return;
            }
            
            try {
                const token = localStorage.getItem('auth_token');
                const announcementData = {
                    title,
                    content,
                    is_urgent: isUrgent
                };

                // Add media if selected
                if (selectedAnnouncementMedia) {
                    announcementData.image_url = selectedAnnouncementMedia;
                }

                const response = await fetch(`${BACKEND_URL}/api/announcements`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(announcementData)
                });
                
                if (response.ok) {
                    clearAnnouncementMedia();
                    closeModal();
                    await loadFeed();
                    showToast('✅ Duyuru paylaşıldı!');
                    
                    // Manuel browser notification göster
                    if (Notification.permission === 'granted') {
                        new Notification('🔔 Yeni Duyuru - Mikel Coffee', {
                            body: `${title.substring(0, 100)}${title.length > 100 ? '...' : ''}`,
                            icon: 'https://customer-assets.emergentagent.com/job_0f64345d-2f6b-41c8-af15-208e01ade896/artifacts/fwptedkg_M%C4%B0KEL%20LOGOSU.png',
                            tag: 'mikel-announcement'
                        });
                    } else {
                        // İzin iste
                        Notification.requestPermission().then(permission => {
                            if (permission === 'granted') {
                                new Notification('🔔 Yeni Duyuru - Mikel Coffee', {
                                    body: `${title.substring(0, 100)}${title.length > 100 ? '...' : ''}`,
                                    icon: 'https://customer-assets.emergentagent.com/job_0f64345d-2f6b-41c8-af15-208e01ade896/artifacts/fwptedkg_M%C4%B0KEL%20LOGOSU.png',
                                    tag: 'mikel-announcement'
                                });
                            }
                        });
                    }
                } else {
                    const error = await response.json();
                    showMessage('Hata: ' + (error.detail || 'Paylaşım başarısız'), 'error');
                }
            } catch (error) {
                showMessage('Bağlantı hatası', 'error');
            }
        }

        function showExamResults() {
            document.getElementById('modalTitle').textContent = 'Sınav Sonuçlarım';
            loadUserExamResults();
            document.getElementById('modalOverlay').style.display = 'flex';
        }

        async function loadUserExamResults() {
            document.getElementById('modalBody').innerHTML = '<div class="loading"><div class="loading-spinner"></div>Yükleniyor...</div>';
            
            try {
                const token = localStorage.getItem('auth_token');
                const [examResponse, usersResponse] = await Promise.all([
                    fetch('${BACKEND_URL}/api/exam-results', {
                        headers: { 'Authorization': `Bearer ${token}` }
                    }),
                    fetch('${BACKEND_URL}/api/users', {
                        headers: { 'Authorization': `Bearer ${token}` }
                    })
                ]);
                
                if (examResponse.ok) {
                    const results = await examResponse.json();
                    
                    // Load users for name mapping if not already loaded
                    if (usersResponse.ok && Object.keys(userMap_global).length === 0) {
                        const users = await usersResponse.json();
                        const newUserMap = {};
                        users.forEach(user => {
                            newUserMap[user.employee_id] = user;
                        });
                        userMap_global = newUserMap;
                    }
                    
                    displayExamResults(results);
                } else {
                    document.getElementById('modalBody').innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">📊</div>
                            <div class="empty-text">Sınav sonucu yok</div>
                            <div class="empty-subtext">Henüz sınav sonucunuz bulunmuyor</div>
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('modalBody').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">❌</div>
                        <div class="empty-text">Yükleme hatası</div>
                        <div class="empty-subtext">Sınav sonuçları yüklenemedi</div>
                    </div>
                `;
            }
        }

        function displayExamResults(results) {
            if (results.length === 0) {
                document.getElementById('modalBody').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">📊</div>
                        <div class="empty-text">Sınav sonucu yok</div>
                        <div class="empty-subtext">Henüz sınav sonucunuz bulunmuyor</div>
                    </div>
                `;
                return;
            }
            
            document.getElementById('modalBody').innerHTML = results.map(result => {
                const percentage = ((result.score / result.max_score) * 100).toFixed(1);
                const statusColor = result.passed ? '#4CAF50' : '#FF5722';
                const statusText = result.passed ? 'GEÇTİ' : 'KALDI';
                
                // Get user info from userMap
                const user = userMap_global[result.employee_id];
                const userName = user ? `${user.name} ${user.surname}` : 'Bilinmeyen Kullanıcı';
                
                return `
                    <div style="border: 1px solid #DBDBDB; border-radius: 8px; padding: 16px; margin-bottom: 12px; border-left: 4px solid ${statusColor};">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <div>
                                <div style="font-weight: 600; color: #262626; margin-bottom: 4px;">
                                    ${result.exam_type === 'management' ? '🎯 Yöneticilik Sınavı' : '📝 Genel Sınav'}
                                </div>
                                <div style="font-size: 12px; color: #8E8E8E;">
                                    📅 ${new Date(result.exam_date).toLocaleDateString('tr-TR')}
                                </div>
                            </div>
                            <span style="background: ${statusColor}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: 600;">
                                ${statusText}
                            </span>
                        </div>
                        
                        <div style="background: #F8F9FA; border-radius: 6px; padding: 12px; margin-bottom: 12px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                                <span style="font-size: 14px; color: #495057;">👤 Öğrenci:</span>
                                <strong style="color: #262626;">${userName}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="font-size: 14px; color: #495057;">🏷️ Sicil No:</span>
                                <strong style="color: #262626;">${result.employee_id}</strong>
                            </div>
                        </div>
                        
                        <div style="background: #FAFAFA; border-radius: 6px; padding: 12px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                                <span style="font-size: 14px;">Puan:</span>
                                <strong>${result.score}/${result.max_score}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                                <span style="font-size: 14px;">Yüzde:</span>
                                <strong>%${percentage}</strong>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="font-size: 14px;">Değerlendiren:</span>
                                <strong>${result.created_by}</strong>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showExamEntry() {
            document.getElementById('modalTitle').textContent = 'Sınav Değerlendirmesi';
            loadUsersForExam();
            document.getElementById('modalOverlay').style.display = 'flex';
        }

        async function loadUsersForExam() {
            document.getElementById('modalBody').innerHTML = '<div class="loading"><div class="loading-spinner"></div>Çalışanlar yükleniyor...</div>';
            
            try {
                const token = localStorage.getItem('auth_token');
                const response = await fetch(`${BACKEND_URL}/api/users`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const users = await response.json();
                    displayExamForm(users);
                } else {
                    document.getElementById('modalBody').innerHTML = '<div style="text-align: center; color: #FF5722; padding: 20px;">Çalışan listesi yüklenemedi</div>';
                }
            } catch (error) {
                document.getElementById('modalBody').innerHTML = '<div style="text-align: center; color: #FF5722; padding: 20px;">Bağlantı hatası</div>';
            }
        }

        function displayExamForm(users) {
            document.getElementById('modalBody').innerHTML = `
                <form id="examForm">
                    <div class="form-group">
                        <select class="form-control" id="examEmployee" required>
                            <option value="">Çalışan seçin...</option>
                            ${users.map(user => `
                                <option value="${user.employee_id}">
                                    ${user.name} ${user.surname} (${user.employee_id})
                                </option>
                            `).join('')}
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <select class="form-control" id="examType" required>
                            <option value="">Sınav türü...</option>
                            <option value="general">📝 Genel Sınav</option>
                            <option value="management">🎯 Yöneticilik Sınavı</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <input type="number" class="form-control" id="examScore" min="0" step="0.5" placeholder="Aldığı puan" required>
                    </div>
                    
                    <div class="form-group">
                        <input type="number" class="form-control" id="examMaxScore" min="1" step="0.5" placeholder="Maksimum puan" required>
                    </div>
                    
                    <div style="background: #E3F2FD; padding: 12px; border-radius: 6px; margin: 15px 0; font-size: 13px; color: #1976D2;">
                        💡 Geçme notu: %80 ve üzeri
                    </div>
                    
                    <button type="submit" class="btn">Kaydet</button>
                </form>
            `;
            
            document.getElementById('examForm').addEventListener('submit', saveExamResult);
        }

        async function saveExamResult(e) {
            e.preventDefault();
            
            const employeeId = document.getElementById('examEmployee').value;
            const examType = document.getElementById('examType').value;
            const score = parseFloat(document.getElementById('examScore').value);
            const maxScore = parseFloat(document.getElementById('examMaxScore').value);
            
            if (score > maxScore) {
                showMessage('Alınan puan maksimum puandan büyük olamaz', 'error');
                return;
            }
            
            try {
                const token = localStorage.getItem('auth_token');
                const response = await fetch('${BACKEND_URL}/api/exam-results', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        employee_id: employeeId,
                        exam_type: examType,
                        score: score,
                        max_score: maxScore
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    const percentage = ((score / maxScore) * 100).toFixed(1);
                    const status = result.passed ? 'GEÇTİ' : 'KALDI';
                    
                    closeModal();
                    showToast(`Sınav kaydedildi! %${percentage} - ${status}`);
                } else {
                    const error = await response.json();
                    showMessage('Hata: ' + (error.detail || 'Kaydetme başarısız'), 'error');
                }
            } catch (error) {
                showMessage('Bağlantı hatası', 'error');
            }
        }

        function showManagementExam() {
            document.getElementById('modalTitle').textContent = 'Yöneticilik Sınavı';
            document.getElementById('modalBody').innerHTML = `
                <div class="empty-state">
                    <div class="empty-icon">🎯</div>
                    <div class="empty-text">Yöneticilik Sınavı</div>
                    <div class="empty-subtext">Bu sınav sadece Barista ve Supervizer pozisyonları için açıktır. Yakında aktif olacak.</div>
                </div>
            `;
            document.getElementById('modalOverlay').style.display = 'flex';
        }

        function showUserManagement() {
            document.getElementById('modalTitle').textContent = 'Çalışan Yönetimi';
            document.getElementById('modalBody').innerHTML = `
                <div>
                    <button onclick="loadAllUsers()" class="btn" style="margin-bottom: 15px;">👥 Tüm Çalışanları Listele</button>
                    <button onclick="exportToExcel()" class="excel-btn">
                        📊 Excel Olarak İndir
                    </button>
                    <div id="usersList"></div>
                </div>
            `;
            document.getElementById('modalOverlay').style.display = 'flex';
        }

        async function exportToExcel() {
            try {
                const token = localStorage.getItem('auth_token');
                const response = await fetch('${BACKEND_URL}/api/admin/export/users', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.style.display = 'none';
                    a.href = url;
                    a.download = `Mikel_Coffee_Calisanlar_${new Date().toISOString().slice(0,10)}.xlsx`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                    
                    showToast('📊 Excel dosyası indirildi!');
                } else {
                    const error = await response.json();
                    showMessage('Hata: ' + (error.detail || 'Excel oluşturulamadı'), 'error');
                }
            } catch (error) {
                showMessage('İndirme hatası', 'error');
            }
        }

        async function loadAllUsers() {
            const usersList = document.getElementById('usersList');
            usersList.innerHTML = '<div class="loading"><div class="loading-spinner"></div>Yükleniyor...</div>';
            
            try {
                const token = localStorage.getItem('auth_token');
                const response = await fetch(`${BACKEND_URL}/api/users`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const users = await response.json();
                    displayUsersList(users);
                } else {
                    const error = await response.json();
                    usersList.innerHTML = `<div style="color: #FF5722; text-align: center; padding: 20px;">Hata: ${error.detail}</div>`;
                }
            } catch (error) {
                usersList.innerHTML = `<div style="color: #FF5722; text-align: center; padding: 20px;">Bağlantı hatası</div>`;
            }
        }

        function displayUsersList(users) {
            const usersList = document.getElementById('usersList');
            
            usersList.innerHTML = `
                <div style="margin-top: 20px;">
                    <div style="font-size: 16px; font-weight: 600; color: #262626; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #DBDBDB;">
                        📋 Kayıtlı Çalışanlar (${users.length})
                    </div>
                    <div style="max-height: 400px; overflow-y: auto;">
                        ${users.map(user => {
                            const userInitials = (user.name?.[0] || '') + (user.surname?.[0] || '');
                            return `
                                <div class="user-item">
                                    <div class="user-avatar">${userInitials}</div>
                                    <div class="user-info">
                                        <div class="user-name">${user.name} ${user.surname}</div>
                                        <div class="user-details">
                                            🏷️ ${user.employee_id} • 💼 ${user.position?.charAt(0).toUpperCase() + user.position?.slice(1)} • 🏪 ${user.store || 'Belirtilmemiş'}
                                        </div>
                                        <div class="user-details">
                                            📧 ${user.email}
                                            ${user.is_admin ? ' • <span style="color: #FF3040; font-weight: 600;">👑 Admin</span>' : ''}
                                            ${user.special_role ? ' • <span style="color: #405DE6; font-weight: 600;">🎓 Eğitim</span>' : ''}
                                        </div>
                                    </div>
                                    <div class="user-actions">
                                        ${user.employee_id !== currentUser.employee_id ? `
                                            ${!user.is_admin ? `
                                                <button class="action-btn admin-btn" onclick="makeUserAdmin('${user.employee_id}', '${user.name} ${user.surname}')" title="Admin Yap">
                                                    👑
                                                </button>
                                            ` : ''}
                                            <button class="action-btn delete-btn" onclick="deleteUser('${user.employee_id}', '${user.name} ${user.surname}')" title="Çalışanı Sil">
                                                🗑️
                                            </button>
                                        ` : '<span style="color: #8E8E8E; font-size: 12px;">Kendinizi silemezsiniz</span>'}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        function closeModal() {
            document.getElementById('modalOverlay').style.display = 'none';
        }

        // Close modal when clicking outside content
        document.addEventListener('click', function(event) {
            const modalOverlay = document.getElementById('modalOverlay');
            const modalContent = document.querySelector('.modal-content');
            
            if (event.target === modalOverlay && !modalContent.contains(event.target)) {
                closeModal();
            }
        });

        // Social Media Functions
        async function toggleAnnouncementLike(announcementId) {
            try {
                const token = localStorage.getItem('auth_token');
                const response = await fetch(`${BACKEND_URL}/api/announcements/${announcementId}/like`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    // Refresh announcements to show updated like count
                    await loadAnnouncements();
                    // Re-render posts
                    document.getElementById('postsContainer').innerHTML = renderPosts();
                    
                    showToast(result.liked ? 'Beğenildi! ❤️' : 'Beğeni kaldırıldı');
                }
            } catch (error) {
                console.error('Like error:', error);
                showToast('Beğeni hatası');
            }
        }

        async function showSocialFeed() {
            await loadUsersWithProfiles(); // Load users and profiles first
            
            const userInitials = (currentUser.name?.[0] || '') + (currentUser.surname?.[0] || '');
            const canUpload = currentUser.is_admin; // Sadece yöneticiler yükleyebilir
            
            document.getElementById('app').innerHTML = `
                <div class="header">
                    <div class="header-content">
                        <div class="logo-section">
                            <img src="https://customer-assets.emergentagent.com/job_0f64345d-2f6b-41c8-af15-208e01ade896/artifacts/fwptedkg_M%C4%B0KEL%20LOGOSU.png" 
                                 alt="Mikel Coffee" class="logo">
                            <div class="brand-name">Mikel Coffee</div>
                        </div>
                        <div class="header-actions">
                            <button class="logout-btn" onclick="showProfile()" title="Profil">👤</button>
                            <button class="logout-btn" onclick="logout()" title="Çıkış">🚪</button>
                        </div>
                    </div>
                </div>

                <div class="feed">
                    <div class="files-header">
                        <div class="files-title">
                            <div class="files-icon">📁</div>
                            <div class="files-text">Dosyalar</div>
                        </div>
                        ${canUpload ? `
                        <button class="btn upload-btn" onclick="showUploadModal()">⬆️ Yükle</button>
                        ` : ''}
                    </div>

                    <div class="files-categories">
                        <div class="category-item" onclick="showVideos()">
                            <div class="category-icon">🎥</div>
                            <div class="category-title">Videolar</div>
                            <div class="category-count" id="videosCount">0</div>
                        </div>
                        <div class="category-item" onclick="showPhotos()">
                            <div class="category-icon">📸</div>
                            <div class="category-title">Fotoğraflar</div>
                            <div class="category-count" id="photosCount">0</div>
                        </div>
                        <div class="category-item" onclick="showForms()">
                            <div class="category-icon">📄</div>
                            <div class="category-title">Formlar</div>
                            <div class="category-count" id="formsCount">0</div>
                        </div>
                    </div>

                    <div id="filesContainer">
                        <div class="files-welcome">
                            <div class="welcome-icon">📁</div>
                            <div class="welcome-text">
                                <h3>Dosyalar Bölümüne Hoş Geldiniz</h3>
                                <p>Yukarıdan bir kategori seçerek dosyaları görüntüleyebilirsiniz.</p>
                                ${canUpload ? '<p>Yönetici olarak dosya yükleyebilirsiniz.</p>' : '<p>Dosyaları görüntüleyebilir ve beğenebilirsiniz.</p>'}
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bottom-nav">
                    <div class="nav-item" onclick="showFeed()">
                        <div class="nav-icon">🏠</div>
                        <div class="nav-label">Ana Sayfa</div>
                    </div>
                    <div class="nav-item active" onclick="showSocialFeed()">
                        <div class="nav-icon">📁</div>
                        <div class="nav-label">Dosyalar</div>
                    </div>
                    <div class="nav-item" onclick="showExamResults()">
                        <div class="nav-icon">📊</div>
                        <div class="nav-label">Sınavlar</div>
                    </div>
                    ${(currentUser.position === 'barista' || currentUser.position === 'supervizer') ? `
                    <div class="nav-item" onclick="showManagementExam()">
                        <div class="nav-icon">🎯</div>
                        <div class="nav-label">Yönetim</div>
                    </div>
                    ` : ''}
                    ${(currentUser.is_admin || currentUser.special_role === 'eğitim departmanı') ? `
                    <div class="nav-item" onclick="showExamEntry()">
                        <div class="nav-icon">📝</div>
                        <div class="nav-label">Sınav</div>
                    </div>
                    ` : ''}
                    ${(currentUser.is_admin || currentUser.special_role === 'eğitim departmanı') ? `
                    <div class="nav-item" onclick="showUserManagement()">
                        <div class="nav-icon">👥</div>
                        <div class="nav-label">Çalışanlar</div>
                    </div>
                    ` : ''}
                </div>

                <div id="modalOverlay" class="modal-overlay" style="display: none;">
                    <div class="modal-content" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <div class="modal-title" id="modalTitle"></div>
                            <button onclick="closeModal()" class="close-btn">✕</button>
                        </div>
                        <div id="modalBody" class="modal-body"></div>
                    </div>
                </div>
            `;
            
            // Initialize file counts
            updateFileCounts();
        }

        // Simple file category loader - KESIN ÇÖZÜM
        function loadFileCategory(category) {
            console.log('📁 LOAD CATEGORY:', category);
            
            let categoryName, categoryIcon, fileType;
            
            if (category === 'videos') {
                categoryName = 'Videolar';
                categoryIcon = '🎥';
                fileType = 'video/*';
            } else if (category === 'photos') {
                categoryName = 'Fotoğraflar';
                categoryIcon = '📸';
                fileType = 'image/*';
            } else if (category === 'forms') {
                categoryName = 'Formlar';
                categoryIcon = '📄';
                fileType = 'application/*';
            }
            
            console.log('📁 Loading files for:', categoryName);
            
            // Immediately show loading screen
            document.getElementById('filesContainer').innerHTML = `
                <div class="files-header">
                    <div class="files-title">
                        <button onclick="showSocialFeed()" style="background:none;border:none;font-size:20px;color:#262626;cursor:pointer;">←</button>
                        <div class="files-icon">${categoryIcon}</div>
                        <div class="files-text">${categoryName}</div>
                    </div>
                    ${currentUser.is_admin ? `<button class="btn upload-btn" onclick="showUploadModal('${category}')">⬆️ Yükle</button>` : ''}
                </div>
                <div class="files-grid">
                    <div style="text-align:center;padding:50px;color:#8E8E8E;">
                        <div style="font-size:32px;margin-bottom:10px;">⏳</div>
                        <div>Yükleniyor...</div>
                    </div>
                </div>
            `;
            
            // Load files from backend
            const token = localStorage.getItem('auth_token');
            fetch(`${BACKEND_URL}/api/files?type=${fileType}`, {
                headers: { 'Authorization': `Bearer ${token}` }
            })
            .then(response => response.json())
            .then(files => {
                console.log('📁 Files loaded:', files.length);
                
                let filesHTML = '';
                if (files.length === 0) {
                    filesHTML = `
                        <div style="text-align:center;padding:50px;color:#8E8E8E;">
                            <div style="font-size:48px;margin-bottom:15px;">${categoryIcon}</div>
                            <div style="font-size:18px;margin-bottom:10px;">Henüz ${categoryName.toLowerCase()} yok</div>
                            <div style="font-size:14px;">${currentUser.is_admin ? 'İlk dosyayı siz yükleyebilirsiniz.' : 'Yöneticiler dosya yüklediğinde burada görünecek.'}</div>
                        </div>
                    `;
                } else {
                    filesHTML = files.map(file => {
                        const token = localStorage.getItem('auth_token');
                        return `
                        <div class="file-item" onclick="openFileViewer('${file.id}', '${file.title}', '${file.content_type}')">
                            <div class="file-preview">
                                ${file.content_type.startsWith('image/') ? 
                                    `<img src="${BACKEND_URL}/api/files/${file.id}/download?token=${token}" alt="${file.title}" style="width:100%;height:150px;object-fit:cover;border-radius:8px;">` :
                                    `<div style="font-size:48px;display:flex;align-items:center;justify-content:center;height:150px;">${getFileIcon(file.content_type)}</div>`
                                }
                            </div>
                            <div class="file-info">
                                <div class="file-title">${file.title}</div>
                                <div class="file-meta">${formatFileSize(file.size)}</div>
                                <div class="file-actions">
                                    <button class="file-like-btn" onclick="event.stopPropagation(); toggleFileLike('${file.id}')">❤️ ${file.likes_count || 0}</button>
                                    <button class="file-download-btn" onclick="event.stopPropagation(); downloadFile('${file.id}')" title="İndir">⬇️</button>
                                    ${currentUser?.is_admin ? `
                                        <button class="action-btn delete-btn" onclick="event.stopPropagation(); deleteFile('${file.id}', '${file.title}')" title="Sil">
                                            🗑️
                                        </button>
                                        <button class="action-btn edit-btn" onclick="event.stopPropagation(); editFile('${file.id}', '${file.title}', '${file.description || ''}')" title="Düzenle">
                                            ✏️
                                        </button>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    `;}).join('');
                }
                
                // Update the files grid
                document.getElementById('filesContainer').innerHTML = `
                    <div class="files-header">
                        <div class="files-title">
                            <button onclick="showSocialFeed()" style="background:none;border:none;font-size:20px;color:#262626;cursor:pointer;">←</button>
                            <div class="files-icon">${categoryIcon}</div>
                            <div class="files-text">${categoryName}</div>
                        </div>
                        ${currentUser.is_admin ? `<button class="btn upload-btn" onclick="showUploadModal('${category}')">⬆️ Yükle</button>` : ''}
                    </div>
                    <div class="files-grid">
                        ${filesHTML}
                    </div>
                `;
            })
            .catch(error => {
                console.error('📁 Error loading files:', error);
                document.getElementById('filesContainer').innerHTML = `
                    <div class="files-header">
                        <div class="files-title">
                            <button onclick="showSocialFeed()" style="background:none;border:none;font-size:20px;color:#262626;cursor:pointer;">←</button>
                            <div class="files-icon">${categoryIcon}</div>
                            <div class="files-text">${categoryName}</div>
                        </div>
                    </div>
                    <div class="files-grid">
                        <div style="text-align:center;padding:50px;color:#FF0000;">
                            <div style="font-size:32px;margin-bottom:10px;">❌</div>
                            <div>Dosyalar yüklenemedi</div>
                        </div>
                    </div>
                `;
            });
        }

        function openFileViewer(fileId, fileName, contentType) {
            console.log('📄 Opening file:', fileName, 'Type:', contentType);
            
            const token = localStorage.getItem('auth_token');
            
            if (contentType.startsWith('image/')) {
                // Show image in modal
                document.getElementById('modalTitle').textContent = fileName;
                document.getElementById('modalBody').innerHTML = `
                    <div style="text-align:center;padding:20px;">
                        <img src="${BACKEND_URL}/api/files/${fileId}/download?token=${token}" 
                             alt="${fileName}" 
                             style="max-width:100%;max-height:70vh;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.15);">
                        <div style="margin-top:15px;">
                            <button class="btn" onclick="downloadFile('${fileId}')">⬇️ İndir</button>
                            <button class="btn-secondary" onclick="closeModal()">Kapat</button>
                        </div>
                    </div>
                `;
                document.getElementById('modalOverlay').style.display = 'flex';
            } else if (contentType.startsWith('video/')) {
                // Show video in modal
                document.getElementById('modalTitle').textContent = fileName;
                document.getElementById('modalBody').innerHTML = `
                    <div style="text-align:center;padding:20px;">
                        <video controls style="max-width:100%;max-height:70vh;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.15);">
                            <source src="${BACKEND_URL}/api/files/${fileId}/download?token=${token}" type="${contentType}">
                            <p>Tarayıcınız bu video formatını desteklemiyor. <a href="${BACKEND_URL}/api/files/${fileId}/download?token=${token}" target="_blank">İndirmek için tıklayın</a></p>
                        </video>
                        <div style="margin-top:15px;">
                            <button class="btn" onclick="downloadFile('${fileId}')">⬇️ İndir</button>
                            <button class="btn-secondary" onclick="closeModal()">Kapat</button>
                        </div>
                    </div>
                `;
                document.getElementById('modalOverlay').style.display = 'flex';
            } else if (contentType.includes('pdf')) {
                // Show PDF in modal
                document.getElementById('modalTitle').textContent = fileName;
                document.getElementById('modalBody').innerHTML = `
                    <div style="text-align:center;padding:20px;">
                        <iframe src="${BACKEND_URL}/api/files/${fileId}/download?token=${token}" 
                                style="width:100%;height:70vh;border:none;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,0.15);">
                        </iframe>
                        <div style="margin-top:15px;">
                            <button class="btn" onclick="downloadFile('${fileId}')">⬇️ İndir</button>
                            <button class="btn-secondary" onclick="closeModal()">Kapat</button>
                        </div>
                    </div>
                `;
                document.getElementById('modalOverlay').style.display = 'flex';
            } else {
                // Direct download for other files
                downloadFile(fileId);
            }
        }

        // Service worker registration for push notifications
        let swRegistration = null;

        async function initializePushNotifications() {
            console.log('🔔 INIT PUSH - Starting push notification initialization...');
            
            if (!('serviceWorker' in navigator)) {
                console.log('❌ INIT PUSH - Service Worker not supported');
                return;
            }
            
            if (!('PushManager' in window)) {
                console.log('❌ INIT PUSH - Push Manager not supported');
                return;
            }

            try {
                // Service Worker'ı kaydet
                console.log('🔔 INIT PUSH - Registering service worker...');
                swRegistration = await navigator.serviceWorker.register('/sw.js');
                console.log('✅ INIT PUSH - Service Worker registered:', swRegistration);

                // Bildirim izni iste - telefon için önemli
                console.log('🔔 INIT PUSH - Requesting notification permission...');
                const permission = await Notification.requestPermission();
                console.log('📱 INIT PUSH - Notification permission:', permission);

                if (permission === 'granted') {
                    console.log('🔔 INIT PUSH - Permission granted, subscribing to push...');
                    await subscribeUserToPush();
                    showToast('📱 Telefon bildirimleri aktif!');
                } else if (permission === 'denied') {
                    console.log('❌ INIT PUSH - Notification permission denied');
                    showToast('❌ Bildirim izni reddedildi. Telefon bildirimleri çalışmayacak.');
                } else {
                    console.log('⚠️ INIT PUSH - Notification permission default/not decided');
                    showToast('⚠️ Bildirim izni belirsiz. Ayarlardan açabilirsiniz.');
                }
            } catch (error) {
                console.error('❌ INIT PUSH - Service Worker registration failed:', error);
                // Hata durumunda sessizce devam et, sistem çökmesin
                console.log('🔔 INIT PUSH - Continuing without push notifications...');
            }
        }

        async function subscribeUserToPush() {
            if (!swRegistration) {
                console.error('❌ SUBSCRIBE PUSH - No service worker registration available');
                return;
            }

            try {
                console.log('🔔 SUBSCRIBE PUSH - Starting subscription process...');
                
                // Check if already subscribed
                const existingSubscription = await swRegistration.pushManager.getSubscription();
                if (existingSubscription) {
                    console.log('✅ SUBSCRIBE PUSH - Already subscribed:', existingSubscription);
                    showToast('📱 Push bildirimleri zaten aktif!');
                    return;
                }

                // Try to subscribe (without VAPID key for now to avoid errors)
                console.log('🔔 SUBSCRIBE PUSH - Creating new subscription...');
                const subscription = await swRegistration.pushManager.subscribe({
                    userVisibleOnly: true
                    // Removed applicationServerKey to avoid VAPID key errors
                });

                console.log('✅ SUBSCRIBE PUSH - User subscribed to push notifications:', subscription);

                // Send subscription to backend
                const token = localStorage.getItem('auth_token');
                console.log('🔔 SUBSCRIBE PUSH - Sending subscription to backend...');
                
                const response = await fetch('${BACKEND_URL}/api/push/subscribe', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        endpoint: subscription.endpoint,
                        keys: subscription.keys ? {
                            p256dh: arrayBufferToBase64(subscription.keys.p256dh),
                            auth: arrayBufferToBase64(subscription.keys.auth)
                        } : {}
                    })
                });

                if (response.ok) {
                    console.log('✅ SUBSCRIBE PUSH - Push subscription sent to backend');
                    showToast('📱 Push bildirimleri aktif!');
                } else {
                    const errorData = await response.json();
                    console.error('❌ SUBSCRIBE PUSH - Failed to send subscription to backend:', errorData);
                    showToast('❌ Push bildirim kaydetme hatası');
                }
            } catch (error) {
                console.error('❌ SUBSCRIBE PUSH - Failed to subscribe to push notifications:', error);
                showToast('❌ Push bildirim hatası: ' + error.message);
            }
        }
        
        function arrayBufferToBase64(buffer) {
            const bytes = new Uint8Array(buffer);
            let binary = '';
            for (let i = 0; i < bytes.byteLength; i++) {
                binary += String.fromCharCode(bytes[i]);
            }
            return window.btoa(binary);
        }

        function urlBase64ToUint8Array(base64String) {
            const padding = '='.repeat((4 - base64String.length % 4) % 4);
            const base64 = (base64String + padding)
                .replace(/-/g, '+')
                .replace(/_/g, '/');

            const rawData = window.atob(base64);
            const outputArray = new Uint8Array(rawData.length);

            for (let i = 0; i < rawData.length; ++i) {
                outputArray[i] = rawData.charCodeAt(i);
            }
            return outputArray;
        }

        // Files management functions
        let currentFileCategory = null;
        let filesData = [];

        async function updateFileCounts() {
            try {
                const token = localStorage.getItem('auth_token');
                
                // Video sayısını getir
                const videoResponse = await fetch('${BACKEND_URL}/api/files?type=video/*', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const videos = videoResponse.ok ? await videoResponse.json() : [];
                
                // Fotoğraf sayısını getir
                const photoResponse = await fetch('${BACKEND_URL}/api/files?type=image/*', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const photos = photoResponse.ok ? await photoResponse.json() : [];
                
                // Form sayısını getir
                const formResponse = await fetch('${BACKEND_URL}/api/files?type=application/*', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const forms = formResponse.ok ? await formResponse.json() : [];
                
                // Sayıları güncelle
                const videosCountEl = document.getElementById('videosCount');
                const photosCountEl = document.getElementById('photosCount');
                const formsCountEl = document.getElementById('formsCount');
                
                if (videosCountEl) videosCountEl.textContent = `${videos.length} dosya`;
                if (photosCountEl) photosCountEl.textContent = `${photos.length} dosya`;
                if (formsCountEl) formsCountEl.textContent = `${forms.length} dosya`;
                
                console.log('📊 FILE COUNTS - Videos:', videos.length, 'Photos:', photos.length, 'Forms:', forms.length);
                
            } catch (error) {
                console.error('❌ Error updating file counts:', error);
                // Fallback to 0
                const videosCountEl = document.getElementById('videosCount');
                const photosCountEl = document.getElementById('photosCount');
                const formsCountEl = document.getElementById('formsCount');
                
                if (videosCountEl) videosCountEl.textContent = '0 dosya';
                if (photosCountEl) photosCountEl.textContent = '0 dosya';
                if (formsCountEl) formsCountEl.textContent = '0 dosya';
            }
        }

        async function showVideos() {
            console.log('🎥 SHOW VIDEOS BAŞLADI');
            
            // Ensure currentUser is loaded
            if (!currentUser) {
                const savedUserData = localStorage.getItem('user');
                if (savedUserData) {
                    currentUser = JSON.parse(savedUserData);
                    console.log('🔧 CURRENT USER RELOADED:', currentUser);
                }
            }
            
            console.log('🔍 CURRENT USER:', currentUser);
            console.log('🔍 IS ADMIN:', currentUser?.is_admin);
            
            // Set category for refresh purposes
            currentFileCategory = 'videos';
            
            // Load videos data first
            await loadFiles('video/*');
            console.log('🎥 SHOW VIDEOS - Files loaded:', filesData.length);
            
            document.getElementById('filesContainer').innerHTML = `
                <div class="files-header">
                    <div class="files-title">
                        <button onclick="showSocialFeed()" style="background:none;border:none;font-size:20px;color:#262626;cursor:pointer;">←</button>
                        <div class="files-icon">🎥</div>
                        <div class="files-text">Videolar</div>
                    </div>
                    ${currentUser?.is_admin ? `<button class="btn upload-btn" onclick="showUploadModal('video')">⬆️ Video Yükle</button>` : ''}
                </div>
                <div class="files-grid" id="videosGrid">
                    ${renderFiles('video')}
                </div>
            `;
        }

        async function showPhotos() {
            console.log('📸 SHOW PHOTOS BAŞLADI');
            
            // Ensure currentUser is loaded
            if (!currentUser) {
                const savedUserData = localStorage.getItem('user');
                if (savedUserData) {
                    currentUser = JSON.parse(savedUserData);
                    console.log('🔧 CURRENT USER RELOADED:', currentUser);
                }
            }
            
            console.log('🔍 CURRENT USER:', currentUser);
            console.log('🔍 IS ADMIN:', currentUser?.is_admin);
            
            // Set category for refresh purposes
            currentFileCategory = 'photos';
            
            // Load photos data first
            await loadFiles('image/*');
            console.log('📸 SHOW PHOTOS - Files loaded:', filesData.length);
            
            document.getElementById('filesContainer').innerHTML = `
                <div class="files-header">
                    <div class="files-title">
                        <button onclick="showSocialFeed()" style="background:none;border:none;font-size:20px;color:#262626;cursor:pointer;">←</button>
                        <div class="files-icon">📸</div>
                        <div class="files-text">Fotoğraflar</div>
                    </div>
                    ${currentUser?.is_admin ? `<button class="btn upload-btn" onclick="showUploadModal('image')">⬆️ Fotoğraf Yükle</button>` : ''}
                </div>
                <div class="files-grid" id="photosGrid">
                    ${renderFiles('image')}
                </div>
            `;
        }

        async function showForms() {
            console.log('📄 SHOW FORMS BAŞLADI');
            
            // Ensure currentUser is loaded
            if (!currentUser) {
                const savedUserData = localStorage.getItem('user');
                if (savedUserData) {
                    currentUser = JSON.parse(savedUserData);
                    console.log('🔧 CURRENT USER RELOADED:', currentUser);
                }
            }
            
            console.log('🔍 CURRENT USER:', currentUser);
            console.log('🔍 IS ADMIN:', currentUser?.is_admin);
            
            // Set category for refresh purposes
            currentFileCategory = 'forms';
            
            // Load forms data first
            await loadFiles('application/*');
            console.log('📄 SHOW FORMS - Files loaded:', filesData.length);
            
            document.getElementById('filesContainer').innerHTML = `
                <div class="files-header">
                    <div class="files-title">
                        <button onclick="showSocialFeed()" style="background:none;border:none;font-size:20px;color:#262626;cursor:pointer;">←</button>
                        <div class="files-icon">📄</div>
                        <div class="files-text">Formlar</div>
                    </div>
                    ${currentUser?.is_admin ? `<button class="btn upload-btn" onclick="showUploadModal('document')">⬆️ Dosya Yükle</button>` : ''}
                </div>
                <div class="files-grid" id="formsGrid">
                    ${renderFiles('document')}
                </div>
            `;
            
            console.log('📄 SHOW FORMS - Grid HTML set, files rendered');
        }

        async function loadFiles(fileType) {
            console.log(`🎥 LOADING FILES - Type: ${fileType}`);
            try {
                const token = localStorage.getItem('auth_token');
                const response = await fetch(`${BACKEND_URL}/api/files?type=${fileType}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    filesData = await response.json();
                    console.log(`✅ Files loaded for ${fileType}:`, filesData.length);
                } else {
                    console.error(`❌ Failed to load files for ${fileType}:`, response.status);
                    filesData = [];
                }
            } catch (error) {
                console.error(`❌ Error loading files for ${fileType}:`, error);
                filesData = [];
            }
        }

        function renderFiles(type) {
            console.log('🔍 RENDER FILES - Type:', type, 'Files count:', filesData.length);
            console.log('🔍 CURRENT USER:', currentUser);
            console.log('🔍 IS ADMIN:', currentUser?.is_admin);
            
            if (filesData.length === 0) {
                const typeNames = {
                    'video': 'video',
                    'image': 'fotoğraf', 
                    'document': 'form'
                };
                
                return `
                    <div class="files-welcome">
                        <div class="welcome-icon">${type === 'video' ? '🎥' : type === 'image' ? '📸' : '📄'}</div>
                        <div class="welcome-text">
                            <h3>Henüz ${typeNames[type]} yok</h3>
                            <p>${currentUser?.is_admin ? 'İlk dosyayı siz yükleyebilirsiniz.' : 'Yöneticiler dosya yüklediğinde burada görüntülenecek.'}</p>
                        </div>
                    </div>
                `;
            }

            return filesData.map(file => {
                const fileIcon = getFileIcon(file.content_type || file.filename);
                const isImage = file.content_type && file.content_type.startsWith('image/');
                
                return `
                    <div class="file-item" onclick="openFile('${file.id}')">
                        <div class="file-preview">
                            ${isImage ? 
                                `<img src="${BACKEND_URL}/api/files/${file.id}/view" alt="${file.title}" style="width:100%;height:100%;object-fit:cover;border-radius:8px;">` :
                            file.content_type && file.content_type.startsWith('video/') ?
                                `<video style="width:100%;height:100%;object-fit:cover;border-radius:8px;" muted>
                                    <source src="${BACKEND_URL}/api/files/${file.id}/view" type="${file.content_type}">
                                </video>` :
                                `<div style="font-size:48px;">${fileIcon}</div>`
                            }
                        </div>
                        <div class="file-info">
                            <div class="file-title">${file.title}</div>
                            <div class="file-meta">
                                ${formatFileSize(file.size)} • ${formatDate(file.created_at)}
                            </div>
                            <div class="file-actions">
                                <button class="file-download-btn" onclick="event.stopPropagation(); downloadFile('${file.id}')" title="İndir">
                                    ⬇️ İndir
                                </button>
                                ${currentUser?.is_admin ? `
                                <button class="action-btn like-btn" onclick="event.stopPropagation(); toggleFileLike('${file.id}')">
                                    ❤️ ${file.likes_count || 0}
                                </button>
                                <button class="action-btn edit-btn" onclick="event.stopPropagation(); editFile('${file.id}', '${file.title}', '${file.description || ''}')" title="Düzenle">
                                    ✏️ Düzenle
                                </button>
                                <button class="action-btn delete-btn" onclick="event.stopPropagation(); deleteFile('${file.id}', '${file.title}')" title="Sil">
                                    🗑️ Sil
                                </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getFileIcon(fileType) {
            if (fileType.startsWith('video/')) return '🎥';
            if (fileType.startsWith('image/')) return '📸';
            if (fileType.includes('pdf')) return '📄';
            if (fileType.includes('word') || fileType.includes('document')) return '📝';
            if (fileType.includes('excel') || fileType.includes('sheet')) return '📊';
            return '📄';
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 1) {
                return 'Dün';
            } else if (diffDays < 7) {
                return `${diffDays} gün önce`;
            } else if (diffDays < 30) {
                const weeks = Math.floor(diffDays / 7);
                return `${weeks} hafta önce`;
            } else {
                return date.toLocaleDateString('tr-TR', { 
                    day: 'numeric', 
                    month: 'short', 
                    year: 'numeric' 
                });
            }
        }

        function showUploadModal(type) {
            const typeNames = {
                'video': 'Video',
                'image': 'Fotoğraf',
                'document': 'Form/Belge'
            };
            
            const acceptTypes = {
                'video': 'video/*',
                'image': 'image/*',
                'document': '.pdf,.doc,.docx,.xls,.xlsx'
            };

            document.getElementById('modalTitle').textContent = `${typeNames[type]} Yükle`;
            document.getElementById('modalBody').innerHTML = `
                <div style="padding: 20px;">
                    <div class="form-group">
                        <label>Dosya Başlığı</label>
                        <input type="text" id="fileTitle" class="form-control" placeholder="Dosya başlığı girin...">
                    </div>
                    <div class="form-group">
                        <label>Açıklama (İsteğe bağlı)</label>
                        <textarea id="fileDescription" class="form-control" placeholder="Dosya açıklaması..." rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Dosya Seç</label>
                        <input type="file" id="fileUploadInput" class="form-control" accept="${acceptTypes[type]}" required>
                        <small style="color: #8E8E8E;">Maksimum dosya boyutu: 100GB</small>
                    </div>
                    <div id="uploadProgress" style="display: none; margin-top: 15px;">
                        <div style="background: #DBDBDB; border-radius: 8px; height: 6px;">
                            <div id="progressBar" style="background: #0095F6; height: 6px; border-radius: 8px; width: 0%; transition: width 0.3s;"></div>
                        </div>
                        <div id="progressText" style="text-align: center; margin-top: 5px; font-size: 14px; color: #8E8E8E;"></div>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn" onclick="uploadFile('${type}')">Yükle</button>
                        <button class="btn-secondary" onclick="closeModal()">İptal</button>
                    </div>
                </div>
            `;
            document.getElementById('modalOverlay').style.display = 'flex';
        }

        async function uploadFile(type) {
            console.log('🚀 UPLOAD BAŞLADI - Type:', type);
            
            const title = document.getElementById('fileTitle').value.trim();
            const description = document.getElementById('fileDescription').value.trim();
            const fileInput = document.getElementById('fileUploadInput');
            const file = fileInput.files[0];

            console.log('📋 FORM VERİLERİ:');
            console.log('- Title:', title);
            console.log('- Description:', description);
            console.log('- File:', file);

            if (!title) {
                console.log('❌ HATA: Başlık boş');
                showToast('❌ Dosya başlığı gerekli');
                return;
            }

            if (!file) {
                console.log('❌ HATA: Dosya seçilmemiş');
                showToast('❌ Lütfen bir dosya seçin');
                return;
            }

            // 100GB limit check
            if (file.size > 100 * 1024 * 1024 * 1024) {
                console.log('❌ HATA: Dosya çok büyük', file.size);
                showToast('❌ Dosya boyutu 100GB\'ı aşamaz');
                return;
            }

            console.log('📦 FORMDATA OLUŞTURULUYOR...');
            const formData = new FormData();
            formData.append('file', file);
            formData.append('title', title);
            formData.append('description', description);
            formData.append('category', type);

            try {
                document.getElementById('uploadProgress').style.display = 'block';
                document.getElementById('progressText').textContent = 'Yükleniyor...';

                const token = localStorage.getItem('auth_token');
                console.log('🌐 BACKEND İSTEĞİ GÖNDERİLİYOR...');
                console.log('- URL:', `${BACKEND_URL}/api/files/upload`);
                console.log('- Token var mı:', !!token);
                
                const response = await fetch(`${BACKEND_URL}/api/files/upload`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` },
                    body: formData
                });

                console.log('📡 RESPONSE ALINDI:', response.status, response.statusText);

                if (response.ok) {
                    const result = await response.json();
                    console.log('✅ BAŞARILI RESPONSE:', result);
                    
                    document.getElementById('progressBar').style.width = '100%';
                    document.getElementById('progressText').textContent = 'Yükleme tamamlandı!';
                    
                    setTimeout(() => {
                        closeModal();
                        showToast('✅ Dosya başarıyla yüklendi!');
                        
                        // Refresh current category
                        console.log('🔄 SAYFA YENİLENİYOR...');
                        if (currentFileCategory === 'videos') showVideos();
                        else if (currentFileCategory === 'photos') showPhotos();
                        else if (currentFileCategory === 'forms') showForms();
                        else showSocialFeed();
                        
                        updateFileCounts();
                    }, 1000);
                } else {
                    const error = await response.json();
                    console.log('❌ BACKEND HATASI:', error);
                    showToast(`❌ Yükleme hatası: ${error.detail || 'Bilinmeyen hata'}`);
                }
            } catch (error) {
                console.error('💥 JAVASCRIPT HATASI:', error);
                showToast('❌ Bağlantı hatası');
            }
        }

        async function toggleFileLike(fileId) {
            try {
                const token = localStorage.getItem('auth_token');
                const response = await fetch(`${BACKEND_URL}/api/files/${fileId}/like`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    // Refresh current category to show updated like count
                    if (currentFileCategory === 'videos') showVideos();
                    else if (currentFileCategory === 'photos') showPhotos(); 
                    else if (currentFileCategory === 'forms') showForms();
                }
            } catch (error) {
                console.error('Like error:', error);
            }
        }

        async function editFile(fileId, currentTitle, currentDescription) {
            // Düzenle modalını göster
            document.getElementById('modalTitle').textContent = 'Dosya Düzenle';
            document.getElementById('modalBody').innerHTML = `
                <div style="padding: 20px;">
                    <div class="form-group">
                        <label>Dosya Başlığı</label>
                        <input type="text" id="editFileTitle" class="form-control" value="${currentTitle.replace(/"/g, '&quot;')}" placeholder="Dosya başlığı...">
                    </div>
                    <div class="form-group">
                        <label>Açıklama</label>
                        <textarea id="editFileDescription" class="form-control" placeholder="Dosya açıklaması..." rows="3">${currentDescription.replace(/"/g, '&quot;')}</textarea>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn" onclick="saveFileEdit('${fileId}')">💾 Kaydet</button>
                        <button class="btn-secondary" onclick="closeModal()">İptal</button>
                    </div>
                </div>
            `;
            document.getElementById('modalOverlay').style.display = 'flex';
        }

        async function saveFileEdit(fileId) {
            const title = document.getElementById('editFileTitle').value.trim();
            const description = document.getElementById('editFileDescription').value.trim();

            if (!title) {
                showToast('❌ Dosya başlığı gerekli');
                return;
            }

            try {
                const token = localStorage.getItem('auth_token');
                const response = await fetch(`${BACKEND_URL}/api/files/${fileId}`, {
                    method: 'PUT',
                    headers: { 
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        title: title,
                        description: description
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    showToast(`✅ "${title}" başarıyla güncellendi`);
                    closeModal();
                    
                    // Güncel kategoriyi yenile
                    if (currentFileCategory === 'videos') showVideos();
                    else if (currentFileCategory === 'photos') showPhotos(); 
                    else if (currentFileCategory === 'forms') showForms();
                    else {
                        // Ana dosya sayfasındaysak sayıları güncelle
                        updateFileCounts();
                    }
                } else {
                    const error = await response.json();
                    showToast(`❌ Güncelleme hatası: ${error.detail || 'Bilinmeyen hata'}`);
                }
            } catch (error) {
                console.error('Edit error:', error);
                showToast('❌ Bağlantı hatası');
            }
        }

        async function deleteFile(fileId, fileName) {
            // Onay diyalogu göster
            const confirmDelete = confirm(`⚠️ DİKKAT!\n\n"${fileName}" adlı dosyayı kalıcı olarak silmek istediğinizden emin misiniz?\n\nBu işlem GERİ ALINAMAZ!`);
            
            if (!confirmDelete) {
                return;
            }

            try {
                const token = localStorage.getItem('auth_token');
                const response = await fetch(`${BACKEND_URL}/api/files/${fileId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const result = await response.json();
                    showToast(`✅ "${result.filename}" başarıyla silindi`);
                    closeModal(); // Modal açıksa kapat
                    
                    // Güncel kategoriyi yenile
                    if (currentFileCategory === 'videos') showVideos();
                    else if (currentFileCategory === 'photos') showPhotos(); 
                    else if (currentFileCategory === 'forms') showForms();
                    else {
                        // Ana dosya sayfasındaysak sayıları güncelle
                        updateFileCounts();
                    }
                } else {
                    const error = await response.json();
                    showToast(`❌ Silme hatası: ${error.detail || 'Bilinmeyen hata'}`);
                }
            } catch (error) {
                console.error('Delete error:', error);
                showToast('❌ Bağlantı hatası');
            }
        }

        function downloadFile(fileId) {
            const token = localStorage.getItem('auth_token');
            window.open(`${BACKEND_URL}/api/files/${fileId}/download?token=${token}`, '_blank');
        }

        function openFile(fileId) {
            console.log('🔍 MODAL AÇILIYOR - File ID:', fileId);
            console.log('🔍 FILES DATA:', filesData);
            
            // File preview modal implementation
            const file = filesData.find(f => f.id === fileId);
            console.log('🔍 BULUNAN FILE:', file);
            
            if (!file) {
                console.error('❌ FILE BULUNAMADI:', fileId);
                return;
            }

            document.getElementById('modalTitle').textContent = file.title;
            document.getElementById('modalBody').innerHTML = `
                <div style="padding: 20px;">
                    <div style="text-align: center; margin-bottom: 20px;">
                        ${file.content_type && file.content_type.startsWith('image/') ? 
                            `<img src="${BACKEND_URL}/api/files/${file.id}/view" style="max-width: 100%; max-height: 400px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);" alt="${file.title}">` :
                        file.content_type && file.content_type.startsWith('video/') ?
                            `<video controls style="max-width: 100%; max-height: 400px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
                                <source src="${BACKEND_URL}/api/files/${file.id}/view" type="${file.content_type}">
                                Tarayıcınız video oynatmayı desteklemiyor.
                            </video>` :
                            `<div style="font-size: 64px; margin: 40px 0; color: #0095F6;">${getFileIcon(file.content_type)}</div>`
                        }
                    </div>
                    <div style="margin-bottom: 15px;">
                        <strong>Dosya Adı:</strong> ${file.title}
                    </div>
                    ${file.description ? `
                    <div style="margin-bottom: 15px;">
                        <strong>Açıklama:</strong> ${file.description}
                    </div>
                    ` : ''}
                    <div style="margin-bottom: 15px;">
                        <strong>Boyut:</strong> ${formatFileSize(file.size)}
                    </div>
                    <div style="margin-bottom: 15px;">
                        <strong>Yüklenme Tarihi:</strong> ${formatDate(file.created_at)}
                    </div>
                    
                    <div style="display: flex; gap: 10px; margin-top: 20px; justify-content: center;">
                        <button onclick="downloadFile('${file.id}')" style="padding: 8px 16px; background: #0095F6; color: white; border: none; border-radius: 8px; cursor: pointer;">
                            ⬇️ İndir
                        </button>
                        ${currentUser?.is_admin ? `
                        <button onclick="toggleFileLike('${file.id}')" style="padding: 8px 16px; background: #fff; border: 1px solid #DBDBDB; border-radius: 8px; cursor: pointer;">
                            ❤️ ${file.likes_count || 0}
                        </button>
                        <button onclick="editFile('${file.id}', '${file.title}', '${file.description || ''}')" style="padding: 8px 16px; background: #0095F6; color: white; border: none; border-radius: 8px; cursor: pointer;">
                            ✏️ Düzenle
                        </button>
                        <button onclick="if(confirm('Bu dosyayı silmek istediğinizden emin misiniz?')) { deleteFile('${file.id}', '${file.title}'); closeModal(); }" style="padding: 8px 16px; background: #ff3040; color: white; border: none; border-radius: 8px; cursor: pointer;">
                            🗑️ Sil
                        </button>
                        ` : ''}
                        <button onclick="closeModal()" style="padding: 8px 16px; background: #8E8E8E; color: white; border: none; border-radius: 8px; cursor: pointer;">
                            Kapat
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('modalOverlay').style.display = 'flex';
        }

        let selectedPostMedia = null;

        function handlePostMediaUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const base64Data = e.target.result;
                selectedPostMedia = base64Data;
                
                const preview = document.getElementById('mediaPreview');
                preview.style.display = 'block';
                
                if (file.type.startsWith('image/')) {
                    preview.innerHTML = `
                        <div class="media-preview-item">
                            <img src="${base64Data}" alt="Önizleme" style="max-width:200px;max-height:150px;border-radius:8px;">
                            <span class="media-type">📷 Fotoğraf</span>
                        </div>
                    `;
                } else if (file.type.startsWith('video/')) {
                    preview.innerHTML = `
                        <div class="media-preview-item">
                            <video src="${base64Data}" controls style="max-width:200px;max-height:150px;border-radius:8px;"></video>
                            <span class="media-type">🎥 Video</span>
                        </div>
                    `;
                }
            };
            reader.readAsDataURL(file);
        }

        function clearPostMedia() {
            selectedPostMedia = null;
            document.getElementById('mediaPreview').style.display = 'none';
            document.getElementById('postMediaUpload').value = '';
        }

        async function createSocialPost() {
            const content = document.getElementById('socialPostContent').value.trim();
            if (!content && !selectedPostMedia) {
                showToast('İçerik veya medya gerekli');
                return;
            }

            try {
                const token = localStorage.getItem('auth_token');
                const postData = { content: content || 'Medya paylaşımı' };
                if (selectedPostMedia) {
                    postData.image_url = selectedPostMedia;
                }

                const response = await fetch('${BACKEND_URL}/api/posts', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(postData)
                });
                
                if (response.ok) {
                    document.getElementById('socialPostContent').value = '';
                    clearPostMedia();
                    await loadSocialPosts();
                    // Re-render the posts container
                    document.getElementById('postsContainer').innerHTML = renderSocialPosts();
                    showToast('Gönderi paylaşıldı! ✨');
                } else {
                    showToast('Paylaşım hatası');
                }
            } catch (error) {
                showToast('Bağlantı hatası');
            }
        }

        async function loadSocialPosts() {
            try {
                const token = localStorage.getItem('auth_token');
                const [postsResponse, usersLoaded] = await Promise.all([
                    fetch('${BACKEND_URL}/api/posts', {
                        headers: { 'Authorization': `Bearer ${token}` }
                    }),
                    loadUsersWithProfiles()
                ]);
                
                if (postsResponse.ok) {
                    socialPosts = await postsResponse.json();
                }
            } catch (error) {
                console.error('Error loading social posts:', error);
                socialPosts = [];
            }
        }

        function renderSocialPosts() {
            if (socialPosts.length === 0) {
                return `
                    <div class="empty-state">
                        <div class="empty-icon">💬</div>
                        <div class="empty-text">Henüz gönderi yok</div>
                        <div class="empty-subtext">İlk gönderiyi siz yapın!</div>
                    </div>
                `;
            }

            return socialPosts.map(post => {
                const timeAgo = getTimeAgo(post.created_at);
                const author = userMap_global[post.author_id];
                const authorName = author ? `${author.name} ${author.surname}` : `Sicil: ${post.author_id}`;
                const authorInitials = author ? 
                    (author.name?.[0] || '') + (author.surname?.[0] || '') : 
                    post.author_id.slice(-2);
                
                // Get author profile image from profiles
                const authorProfileImage = author && author.profile_image_url ? author.profile_image_url : null;
                
                return `
                    <div class="social-post">
                        <div class="post-header">
                            <div class="post-user" onclick="showProfile('${post.author_id}')">
                                <div class="post-avatar">
                                    ${authorProfileImage ? 
                                        `<img src="${authorProfileImage}" alt="Profil" style="width:100%;height:100%;object-fit:cover;border-radius:50%;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">` : 
                                        ''
                                    }
                                    <div class="avatar-initials" ${authorProfileImage ? 'style="display:none;"' : ''}>${authorInitials}</div>
                                </div>
                                <div class="post-info">
                                    <div class="post-username">${authorName}</div>
                                    <div class="post-time">${timeAgo}</div>
                                </div>
                            </div>
                        </div>
                        <div class="post-content">
                            <div class="post-text">${post.content}</div>
                            ${post.image_url ? `
                                <div class="post-media">
                                    ${post.image_url.startsWith('data:video/') ? 
                                        `<video src="${post.image_url}" controls style="width:100%;max-height:400px;border-radius:8px;margin-top:10px;"></video>` :
                                        `<img src="${post.image_url}" alt="Post media" style="width:100%;max-height:400px;object-fit:cover;border-radius:8px;margin-top:10px;">`
                                    }
                                </div>
                            ` : ''}
                        </div>
                        <div class="post-actions">
                            <button class="action-btn like-btn" onclick="togglePostLike('${post._id}')">
                                ❤️ ${post.likes_count || 0}
                            </button>
                            <button class="action-btn comment-btn" onclick="showComments('${post._id}')">
                                💬 ${post.comments_count || 0}
                            </button>
                            <button class="action-btn share-btn" onclick="sharePost('${post._id}')" title="Paylaş">
                                📤
                            </button>
                            ${(currentUser.is_admin || post.author_id === currentUser.employee_id) ? `
                                <button class="action-btn delete-btn" onclick="deletePost('${post.id || post._id}')" title="Sil">
                                    🗑️
                                </button>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function togglePostLike(postId) {
            try {
                const token = localStorage.getItem('auth_token');
                const response = await fetch(`${BACKEND_URL}/api/posts/${postId}/like`, {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const result = await response.json();
                    await loadSocialPosts();
                    // Re-render the posts container if we're on social feed page
                    const postsContainer = document.getElementById('postsContainer');
                    if (postsContainer) {
                        postsContainer.innerHTML = renderSocialPosts();
                    }
                    showToast(result.liked ? 'Beğenildi! ❤️' : 'Beğeni kaldırıldı');
                }
            } catch (error) {
                showToast('Beğeni hatası');
            }
        }

        async function sharePost(postId) {
            try {
                const post = socialPosts.find(p => p._id === postId);
                if (!post) {
                    showToast('Gönderi bulunamadı');
                    return;
                }

                const author = userMap_global[post.author_id];
                const authorName = author ? `${author.name} ${author.surname}` : `Sicil: ${post.author_id}`;
                
                const shareText = `${authorName} tarafından paylaşılan gönderi:\n\n"${post.content}"\n\n#MikelCoffee`;
                
                if (navigator.share) {
                    // Use native sharing if available
                    await navigator.share({
                        title: 'Mikel Coffee - Gönderi Paylaş',
                        text: shareText,
                        url: window.location.href
                    });
                    showToast('Paylaşıldı! 📤');
                } else {
                    // Fallback to clipboard
                    await navigator.clipboard.writeText(shareText);
                    showToast('Metin panoya kopyalandı! 📋');
                }
            } catch (error) {
                console.error('Share error:', error);
                showToast('Paylaşım hatası');
            }
        }

        // Comments System
        async function showComments(postId) {
            document.getElementById('modalTitle').textContent = 'Yorumlar';
            document.getElementById('modalBody').innerHTML = `
                <div class="comments-section">
                    <div class="add-comment">
                        <div class="comment-input-container">
                            <div class="user-avatar-small">
                                ${userMap_global[currentUser.employee_id]?.profile_image_url ? 
                                    `<img src="${userMap_global[currentUser.employee_id].profile_image_url}" alt="Profil" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">` :
                                    `<div class="avatar-initials">${(currentUser.name?.[0] || '') + (currentUser.surname?.[0] || '')}</div>`
                                }
                            </div>
                            <div class="comment-input-area">
                                <textarea class="comment-input" id="commentInput" placeholder="Yorum yaz..." maxlength="500"></textarea>
                                <button class="comment-send-btn" onclick="addComment('${postId}')">Gönder</button>
                            </div>
                        </div>
                    </div>
                    <div id="commentsList" class="comments-list">
                        <div class="loading"><div class="loading-spinner"></div>Yorumlar yükleniyor...</div>
                    </div>
                </div>
            `;
            document.getElementById('modalOverlay').style.display = 'flex';
            loadComments(postId);
        }

        async function loadComments(postId) {
            try {
                const token = localStorage.getItem('auth_token');
                const response = await fetch(`${BACKEND_URL}/api/posts/${postId}/comments`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const comments = await response.json();
                    displayComments(comments);
                } else {
                    document.getElementById('commentsList').innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">💬</div>
                            <div class="empty-text">Henüz yorum yok</div>
                            <div class="empty-subtext">İlk yorumu siz yapın!</div>
                        </div>
                    `;
                }
            } catch (error) {
                document.getElementById('commentsList').innerHTML = `
                    <div class="error-state">
                        <div class="empty-icon">❌</div>
                        <div class="empty-text">Yorumlar yüklenemedi</div>
                    </div>
                `;
            }
        }

        function displayComments(comments) {
            if (comments.length === 0) {
                document.getElementById('commentsList').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">💬</div>
                        <div class="empty-text">Henüz yorum yok</div>
                        <div class="empty-subtext">İlk yorumu siz yapın!</div>
                    </div>
                `;
                return;
            }

            const commentsHtml = comments.map(comment => {
                const author = userMap_global[comment.author_id];
                const authorName = author ? `${author.name} ${author.surname}` : `Sicil: ${comment.author_id}`;
                const timeAgo = getTimeAgo(comment.created_at);
                
                return `
                    <div class="comment-item">
                        <div class="comment-avatar">
                            ${author && author.profile_image_url ? 
                                `<img src="${author.profile_image_url}" alt="Profil" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">` :
                                `<div class="avatar-initials">${author ? (author.name?.[0] || '') + (author.surname?.[0] || '') : comment.author_id.slice(-2)}</div>`
                            }
                        </div>
                        <div class="comment-content">
                            <div class="comment-header">
                                <span class="comment-author">${authorName}</span>
                                <span class="comment-time">${timeAgo}</span>
                            </div>
                            <div class="comment-text">${comment.content}</div>
                        </div>
                    </div>
                `;
            }).join('');
            
            document.getElementById('commentsList').innerHTML = commentsHtml;
        }

        async function addComment(postId) {
            const commentText = document.getElementById('commentInput').value.trim();
            if (!commentText) {
                showToast('Yorum boş olamaz');
                return;
            }

            try {
                const token = localStorage.getItem('auth_token');
                const response = await fetch(`${BACKEND_URL}/api/posts/${postId}/comments`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ content: commentText })
                });
                
                if (response.ok) {
                    document.getElementById('commentInput').value = '';
                    showToast('Yorum eklendi! 💬');
                    await loadComments(postId);
                    // Refresh posts to update comment count
                    await loadSocialPosts();
                    const postsContainer = document.getElementById('postsContainer');
                    if (postsContainer) {
                        postsContainer.innerHTML = renderSocialPosts();
                    }
                } else {
                    showToast('Yorum eklenemedi');
                }
            } catch (error) {
                showToast('Bağlantı hatası');
            }
        }

        // Profile Functions
        async function showProfile(userId = null) {
            // Önce kullanıcı profil verilerini yükle
            await loadUsersWithProfiles();
            
            const targetUser = userId ? userMap_global[userId] : userMap_global[currentUser.employee_id];
            const isOwnProfile = !userId || userId === currentUser.employee_id;
            
            // Profil bilgileri eksikse currentUser'dan al
            const profileUser = {
                ...targetUser,
                employee_id: targetUser?.employee_id || currentUser.employee_id,
                name: targetUser?.name || currentUser.name,
                surname: targetUser?.surname || currentUser.surname,
                position: targetUser?.position || currentUser.position,
                store: targetUser?.store || currentUser.store,
                profile_image_url: targetUser?.profile_image_url || null
            };
            
            console.log('🔍 PROFILE DEBUG - Showing profile for:', profileUser.employee_id);
            console.log('🔍 PROFILE DEBUG - Has profile image:', profileUser.profile_image_url ? 'YES' : 'NO');
            
            // Load user's posts if viewing specific user
            let userPosts = [];
            if (userId) {
                userPosts = socialPosts.filter(post => post.author_id === userId);
            } else {
                userPosts = socialPosts.filter(post => post.author_id === currentUser.employee_id);
            }

            document.getElementById('app').innerHTML = `
                <div class="header">
                    <div class="header-content">
                        <div class="logo-section">
                            <button onclick="showFeed()" style="background:none;border:none;color:#262626;font-size:24px;">←</button>
                            <div class="brand-name">${profileUser.name} ${profileUser.surname}</div>
                        </div>
                        <div class="header-actions">
                            ${isOwnProfile ? '<button class="logout-btn" onclick="showSettings()" title="Ayarlar">⚙️</button>' : ''}
                            <button class="logout-btn" onclick="logout()" title="Çıkış">🚪</button>
                        </div>
                    </div>
                </div>

                <div class="instagram-profile">
                    <div class="profile-header-section">
                        <div class="profile-image-container">
                            <div class="profile-picture-instagram" id="profilePictureDisplay">
                                ${profileUser.profile_image_url ? 
                                    `<img src="${profileUser.profile_image_url}" alt="Profil" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">` :
                                    `${profileUser.name?.[0] || ''}${profileUser.surname?.[0] || ''}`
                                }
                            </div>
                        </div>
                        
                        <div class="profile-info-instagram">
                            <div class="profile-name-section">
                                <h2 class="profile-username">${profileUser.name} ${profileUser.surname}</h2>
                                ${isOwnProfile ? '<button class="edit-profile-btn" onclick="editProfile()">Profili Düzenle</button>' : ''}
                            </div>
                            
                            <div class="profile-stats">
                                <div class="stat">
                                    <span class="stat-number">${userPosts.length}</span>
                                    <span class="stat-label">gönderi</span>
                                </div>
                            </div>
                            
                            <div class="profile-bio">
                                <strong>${profileUser.position?.charAt(0).toUpperCase() + profileUser.position?.slice(1)}</strong>
                                ${profileUser.store ? `<br>📍 ${profileUser.store}` : ''}
                                <div id="userBio">Yükleniyor...</div>
                            </div>
                        </div>
                    </div>

                    <div class="profile-content-tabs">
                        <div class="tab active" onclick="showUserPosts('${targetUser.employee_id}')">
                            <span>📱</span> GÖNDERİLER
                        </div>
                        <div class="tab" onclick="showUserMedia('${targetUser.employee_id}')">
                            <span>📸</span> MEDYA
                        </div>
                    </div>

                    <div class="profile-posts-grid" id="userPostsGrid">
                        ${renderUserPostsGrid(userPosts)}
                    </div>
                </div>

                ${isOwnProfile ? '<input type="file" id="profileImageUpload" accept="image/*" style="display:none" onchange="handleProfileImageUpload(event)">' : ''}
                
                <div id="modalOverlay" class="modal-overlay" style="display: none;">
                    <div class="modal-content" onclick="event.stopPropagation()">
                        <div class="modal-header">
                            <div class="modal-title" id="modalTitle"></div>
                            <button onclick="closeModal()" class="close-btn">✕</button>
                        </div>
                        <div id="modalBody" class="modal-body"></div>
                    </div>
                </div>
            `;
            
            if (isOwnProfile) {
                loadCurrentProfile();
            } else if (userId) {
                loadUserProfile(userId);
            }
        }

        function renderUserPostsGrid(posts) {
            if (posts.length === 0) {
                return `
                    <div class="empty-posts">
                        <div class="empty-icon">📱</div>
                        <div class="empty-text">Henüz gönderi yok</div>
                    </div>
                `;
            }

            return `
                <div class="posts-grid">
                    ${posts.map(post => `
                        <div class="post-grid-item" onclick="openPostModal('${post._id}')">
                            <div class="post-grid-content">
                                <p>${post.content}</p>
                                <div class="post-grid-stats">
                                    <span>❤️ ${post.likes_count || 0}</span>
                                    <span>💬 ${post.comments_count || 0}</span>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        async function loadCurrentProfile() {
            try {
                const token = localStorage.getItem('auth_token');
                const response = await fetch('${BACKEND_URL}/api/profile', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const profile = await response.json();
                    if (profile.bio) {
                        document.getElementById('userBio').textContent = profile.bio;
                    }
                    if (profile.profile_image_url) {
                        document.getElementById('profilePictureDisplay').innerHTML = `
                            <img src="${profile.profile_image_url}" alt="Profil" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">
                        `;
                    }
                }
            } catch (error) {
                console.error('Profile load error:', error);
            }
        }

        function uploadProfilePicture() {
            document.getElementById('profileImageUpload').click();
        }

        async function handleProfileImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            // Convert file to base64 for storage
            const reader = new FileReader();
            reader.onload = async function(e) {
                const base64Image = e.target.result;
                
                try {
                    const token = localStorage.getItem('auth_token');
                    const response = await fetch('${BACKEND_URL}/api/profile', {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({
                            profile_image_url: base64Image
                        })
                    });
                    
                    if (response.ok) {
                        document.getElementById('profilePictureDisplay').innerHTML = `
                            <img src="${base64Image}" alt="Profil" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">
                        `;
                        showToast('Profil fotoğrafı güncellendi! ✨');
                    } else {
                        showToast('Güncelleme hatası');
                    }
                } catch (error) {
                    showToast('Fotoğraf yükleme hatası');
                }
            };
            reader.readAsDataURL(file);
        }

        async function updateProfile() {
            const bio = document.getElementById('profileBio').value.trim();
            
            try {
                const token = localStorage.getItem('auth_token');
                const response = await fetch('${BACKEND_URL}/api/profile', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ bio })
                });
                
                if (response.ok) {
                    showToast('Profil güncellendi! ✨');
                } else {
                    showToast('Güncelleme hatası');
                }
            } catch (error) {
                showToast('Bağlantı hatası');
            }
        }

        function renderUsersList() {
            const users = Object.values(userMap_global).slice(0, 10); // Show top 10 users
            if (users.length === 0) {
                return '<div class="no-users">Kullanıcı bulunamadı</div>';
            }

            return users.map(user => {
                const userInitials = (user.name?.[0] || '') + (user.surname?.[0] || '');
                const userPosts = socialPosts.filter(post => post.author_id === user.employee_id);
                
                return `
                    <div class="user-item" onclick="showProfile('${user.employee_id}')">
                        <div class="user-avatar">
                            ${user.profile_image_url ? 
                                `<img src="${user.profile_image_url}" alt="Profil" style="width:100%;height:100%;object-fit:cover;border-radius:50%;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">` : 
                                ''
                            }
                            <div class="avatar-initials" ${user.profile_image_url ? 'style="display:none;"' : ''}>${userInitials}</div>
                        </div>
                        <div class="user-info">
                            <div class="user-name">${user.name} ${user.surname}</div>
                            <div class="user-position">${user.position}</div>
                            <div class="user-stats">${userPosts.length} gönderi</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        async function loadUserProfile(userId) {
            try {
                const token = localStorage.getItem('auth_token');
                const response = await fetch('${BACKEND_URL}/api/profile', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const profile = await response.json();
                    const bioElement = document.getElementById('userBio');
                    if (bioElement) {
                        bioElement.textContent = profile.bio || 'Bio bulunmuyor.';
                    }
                }
            } catch (error) {
                console.error('User profile load error:', error);
            }
        }

        function showUserPosts(userId) {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            event.target.closest('.tab').classList.add('active');
            
            const userPosts = socialPosts.filter(post => post.author_id === userId);
            document.getElementById('userPostsGrid').innerHTML = renderUserPostsGrid(userPosts);
        }

        function showUserMedia(userId) {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            event.target.closest('.tab').classList.add('active');
            
            // Filter posts with images/media
            const userPosts = socialPosts.filter(post => 
                post.author_id === userId && post.image_url
            );
            
            document.getElementById('userPostsGrid').innerHTML = `
                <div class="media-grid">
                    ${userPosts.length === 0 ? 
                        '<div class="empty-posts"><div class="empty-icon">📸</div><div class="empty-text">Medya yok</div></div>' :
                        userPosts.map(post => `
                            <div class="media-item" onclick="openPostModal('${post._id}')">
                                <img src="${post.image_url}" alt="Post media">
                            </div>
                        `).join('')
                    }
                </div>
            `;
        }

        function editProfile() {
            document.getElementById('modalTitle').textContent = 'Profili Düzenle';
            document.getElementById('modalBody').innerHTML = `
                <div class="edit-profile-form">
                    <div class="form-group">
                        <label>Profil Fotoğrafı</label>
                        <div class="profile-picture-edit" id="editProfilePictureDisplay">
                            ${userMap_global[currentUser.employee_id]?.profile_image_url ? 
                                `<img src="${userMap_global[currentUser.employee_id].profile_image_url}" alt="Profil" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">` :
                                `${currentUser.name?.[0] || ''}${currentUser.surname?.[0] || ''}`
                            }
                        </div>
                        <button class="btn-secondary" onclick="uploadProfilePictureEdit()">Galeri'den Seç</button>
                        <input type="file" id="editProfileImageUpload" accept="image/*" style="display:none" onchange="handleEditProfileImageUpload(event)">
                    </div>
                    
                    <div class="form-group">
                        <label>Ad</label>
                        <input type="text" class="form-control" id="editFirstName" placeholder="Adınız" value="${currentUser.name || ''}" maxlength="50" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Soyad</label>
                        <input type="text" class="form-control" id="editLastName" placeholder="Soyadınız" value="${currentUser.surname || ''}" maxlength="50" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Pozisyon</label>
                        <select class="form-control" id="editPosition" required>
                            <option value="">Pozisyon seçin</option>
                            <option value="servis personeli" ${currentUser.position === 'servis personeli' ? 'selected' : ''}>Servis Personeli</option>
                            <option value="barista" ${currentUser.position === 'barista' ? 'selected' : ''}>Barista</option>
                            <option value="supervizer" ${currentUser.position === 'supervizer' ? 'selected' : ''}>Supervisor</option>
                            <option value="müdür yardımcısı" ${currentUser.position === 'müdür yardımcısı' ? 'selected' : ''}>Müdür Yardımcısı</option>
                            <option value="mağaza müdürü" ${currentUser.position === 'mağaza müdürü' ? 'selected' : ''}>Mağaza Müdürü</option>
                            <option value="trainer" ${currentUser.position === 'trainer' ? 'selected' : ''}>Trainer</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Mağaza (Opsiyonel)</label>
                        <input type="text" class="form-control" id="editStore" placeholder="Mağaza adı" value="${currentUser.store || ''}" maxlength="100">
                    </div>
                    
                    <div class="form-group">
                        <label>Biyografi</label>
                        <textarea class="form-control" id="editProfileBio" placeholder="Kendin hakkında bir şeyler yaz..." maxlength="200"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Yeni Şifre (İsteğe bağlı)</label>
                        <input type="password" class="form-control" id="editPassword" placeholder="Yeni şifrenizi girin (boş bırakırsanız değişmez)" maxlength="100">
                    </div>
                    
                    <div class="form-group">
                        <label>Yeni Şifre Tekrar</label>
                        <input type="password" class="form-control" id="editPasswordConfirm" placeholder="Yeni şifrenizi tekrar girin" maxlength="100">
                    </div>
                    
                    <div class="form-actions">
                        <button class="btn-secondary" onclick="closeModal()">İptal</button>
                        <button class="btn" onclick="updateCompleteProfile()">Kaydet</button>
                    </div>
                </div>
            `;
            document.getElementById('modalOverlay').style.display = 'flex';
            loadEditProfile();
        }

        function uploadProfilePictureEdit() {
            document.getElementById('editProfileImageUpload').click();
        }

        async function handleEditProfileImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const base64Image = e.target.result;
                document.getElementById('editProfilePictureDisplay').innerHTML = `
                    <img src="${base64Image}" alt="Profil" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">
                `;
            };
            reader.readAsDataURL(file);
        }

        async function loadEditProfile() {
            try {
                const token = localStorage.getItem('auth_token');
                const response = await fetch('${BACKEND_URL}/api/profile', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    const profile = await response.json();
                    if (profile.bio) {
                        document.getElementById('editProfileBio').value = profile.bio;
                    }
                    if (profile.profile_image_url) {
                        document.getElementById('editProfilePictureDisplay').innerHTML = `
                            <img src="${profile.profile_image_url}" alt="Profil" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">
                        `;
                    }
                }
            } catch (error) {
                console.error('Profile load error:', error);
            }
        }

        async function updateCompleteProfile() {
            const firstName = document.getElementById('editFirstName').value.trim();
            const lastName = document.getElementById('editLastName').value.trim();
            const position = document.getElementById('editPosition').value;
            const store = document.getElementById('editStore').value.trim();
            const bio = document.getElementById('editProfileBio').value.trim();
            const password = document.getElementById('editPassword').value.trim();
            const passwordConfirm = document.getElementById('editPasswordConfirm').value.trim();
            const imageElement = document.getElementById('editProfilePictureDisplay').querySelector('img');
            const profileImageUrl = imageElement ? imageElement.src : null;
            
            if (!firstName || !lastName || !position) {
                showToast('❌ Ad, soyad ve pozisyon gereklidir');
                return;
            }
            
            // Şifre kontrolü
            if (password && password !== passwordConfirm) {
                showToast('❌ Şifreler eşleşmiyor');
                return;
            }
            
            if (password && password.length < 6) {
                showToast('❌ Şifre en az 6 karakter olmalı');
                return;
            }
            
            try {
                const token = localStorage.getItem('auth_token');
                
                // Update user info first
                const userUpdateData = {
                    name: firstName,
                    surname: lastName,
                    position: position,
                    store: store || null
                };
                
                // Şifre varsa ekle
                if (password) {
                    userUpdateData.password = password;
                }

                const userResponse = await fetch('${BACKEND_URL}/api/users/me', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(userUpdateData)
                });
                
                // Update profile info
                const profileUpdateData = { bio };
                if (profileImageUrl && profileImageUrl.includes('data:image/')) {
                    profileUpdateData.profile_image_url = profileImageUrl;
                }

                const profileResponse = await fetch('${BACKEND_URL}/api/profile', {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(profileUpdateData)
                });
                
                if (userResponse.ok && profileResponse.ok) {
                    // Update current user data
                    const userResult = await userResponse.json();
                    if (userResult.user) {
                        currentUser.name = userResult.user.name;
                        currentUser.surname = userResult.user.surname;
                        currentUser.position = userResult.user.position;
                        currentUser.store = userResult.user.store;
                        localStorage.setItem('user', JSON.stringify(currentUser));
                    }
                    
                    showToast('✅ Profil başarıyla güncellendi!');
                    closeModal();
                    
                    // Refresh data and page
                    await loadUsersWithProfiles();
                    showProfile();
                } else {
                    const userError = userResponse.ok ? null : await userResponse.json();
                    const profileError = profileResponse.ok ? null : await profileResponse.json();
                    const errorMessage = userError?.detail || profileError?.detail || 'Güncelleme hatası';
                    showToast(`❌ ${errorMessage}`);
                }
            } catch (error) {
                console.error('Profile update error:', error);
                showToast('❌ Bağlantı hatası');
            }
        }

        function openPostModal(postId) {
            const post = socialPosts.find(p => p._id === postId);
            if (!post) return;
            
            const author = userMap_global[post.author_id];
            const authorName = author ? `${author.name} ${author.surname}` : `Sicil: ${post.author_id}`;
            const timeAgo = getTimeAgo(post.created_at);
            
            document.getElementById('modalTitle').textContent = 'Gönderi';
            document.getElementById('modalBody').innerHTML = `
                <div class="post-modal">
                    <div class="post-header">
                        <div class="post-user">
                            <div class="post-avatar">
                                ${author && author.profile_image_url ? 
                                    `<img src="${author.profile_image_url}" alt="Profil" style="width:100%;height:100%;object-fit:cover;border-radius:50%;">` : 
                                    `<div class="avatar-initials">${author ? (author.name?.[0] || '') + (author.surname?.[0] || '') : post.author_id.slice(-2)}</div>`
                                }
                            </div>
                            <div class="post-info">
                                <div class="post-username">${authorName}</div>
                                <div class="post-time">${timeAgo}</div>
                            </div>
                        </div>
                    </div>
                    <div class="post-content">
                        <div class="post-text">${post.content}</div>
                    </div>
                    <div class="post-actions">
                        <button class="action-btn like-btn" onclick="togglePostLike('${post._id}')">
                            ❤️ ${post.likes_count || 0}
                        </button>
                        <button class="action-btn comment-btn">
                            💬 ${post.comments_count || 0}
                        </button>
                        ${(currentUser.is_admin || post.author_id === currentUser.employee_id) ? `
                            <button class="action-btn delete-btn" onclick="deletePost('${post._id}'); closeModal();" title="Sil">
                                🗑️
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
            document.getElementById('modalOverlay').style.display = 'flex';
        }

        // Delete Functions
        async function deleteAnnouncement(announcementId) {
            if (!confirm('Bu duyuruyu silmek istediğinizden emin misiniz?')) return;
            
            try {
                const token = localStorage.getItem('auth_token');
                console.log('Deleting announcement with ID:', announcementId);
                
                const response = await fetch(`${BACKEND_URL}/api/announcements/${announcementId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    showToast('Duyuru silindi! 🗑️');
                    // Remove from local array immediately
                    announcements = announcements.filter(a => a._id !== announcementId && a.id !== announcementId);
                    
                    // Re-render all containers immediately
                    const postsContainer = document.getElementById('postsContainer');
                    if (postsContainer) {
                        postsContainer.innerHTML = renderPosts();
                    }
                    
                    // Reload from server to be sure
                    await loadAnnouncements();
                } else {
                    console.error('Delete failed with status:', response.status);
                    showToast('Silme hatası - ' + response.status);
                }
            } catch (error) {
                console.error('Delete error:', error);
                showToast('Bağlantı hatası');
            }
        }

        async function deletePost(postId) {
            if (!confirm('Bu gönderiyi silmek istediğinizden emin misiniz?')) return;
            
            try {
                const token = localStorage.getItem('auth_token');
                const response = await fetch(`${BACKEND_URL}/api/posts/${postId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    showToast('Gönderi silindi! 🗑️');
                    await loadSocialPosts();
                    // Re-render posts container if we're on social feed page
                    const postsContainer = document.getElementById('postsContainer');
                    if (postsContainer) {
                        postsContainer.innerHTML = renderSocialPosts();
                    }
                } else {
                    showToast('Silme hatası');
                }
            } catch (error) {
                showToast('Bağlantı hatası');
            }
        }

        // Announcement Media Functions
        let selectedAnnouncementMedia = null;

        function handleAnnouncementMediaUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const base64Data = e.target.result;
                selectedAnnouncementMedia = base64Data;
                
                const preview = document.getElementById('announcementMediaPreview');
                preview.style.display = 'block';
                
                if (file.type.startsWith('image/')) {
                    preview.innerHTML = `
                        <div class="media-preview-item">
                            <img src="${base64Data}" alt="Önizleme" style="max-width:200px;max-height:150px;border-radius:8px;">
                            <span class="media-type">📷 Fotoğraf</span>
                        </div>
                    `;
                } else if (file.type.startsWith('video/')) {
                    preview.innerHTML = `
                        <div class="media-preview-item">
                            <video src="${base64Data}" controls style="max-width:200px;max-height:150px;border-radius:8px;"></video>
                            <span class="media-type">🎥 Video</span>
                        </div>
                    `;
                }
            };
            reader.readAsDataURL(file);
        }

        function clearAnnouncementMedia() {
            selectedAnnouncementMedia = null;
            document.getElementById('announcementMediaPreview').style.display = 'none';
            document.getElementById('announcementMediaUpload').value = '';
        }

        // User Management Functions
        async function deleteUser(employeeId, userName) {
            if (!confirm(`⚠️ DİKKAT!\n\n${userName} adlı çalışanı ve tüm verilerini kalıcı olarak silmek istediğinizden emin misiniz?\n\n• Çalışan profili\n• Tüm gönderileri\n• Sınav sonuçları\n• Tüm beğenileri ve yorumları\n\nBu işlem GERİ ALINAMAZ!`)) {
                return;
            }
            
            try {
                const token = localStorage.getItem('auth_token');
                const response = await fetch(`${BACKEND_URL}/api/admin/users/${employeeId}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                
                if (response.ok) {
                    showToast(`✅ ${userName} başarıyla silindi!`);
                    // Refresh the user list
                    await loadAllUsers();
                } else {
                    const error = await response.json();
                    showToast(`❌ Silme hatası: ${error.detail || 'Bilinmeyen hata'}`);
                }
            } catch (error) {
                console.error('Delete user error:', error);
                showToast('❌ Bağlantı hatası');
            }
        }

        async function makeUserAdmin(employeeId, userName) {
            if (!confirm(`👑 ADMİN YETKİSİ VER\n\n${userName} adlı çalışana admin yetkisi vermek istediğinizden emin misiniz?\n\nAdmin yetkisi ile bu kullanıcı:\n• Tüm çalışanları yönetebilir\n• Başka kullanıcıları admin yapabilir\n• Tüm sistem özelliklerine erişebilir\n\nBu yetkiyi sadece güvendiğiniz kişilere verin!`)) {
                return;
            }
            
            try {
                const token = localStorage.getItem('auth_token');
                const response = await fetch(`${BACKEND_URL}/api/admin/users/${employeeId}/admin-status`, {
                    method: 'PUT',
                    headers: { 
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        is_admin: true,
                        reason: `Admin yetkisi ${currentUser.name} ${currentUser.surname} tarafından verildi`
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showToast(`✅ ${userName} artık admin!`);
                    // Refresh the user list to show updated admin status
                    await loadAllUsers();
                } else {
                    showToast(`❌ Admin yapma hatası: ${result.detail || 'Bilinmeyen hata'}`);
                }
            } catch (error) {
                console.error('Make admin error:', error);
                showToast('❌ Bağlantı hatası');
            }
        }

        function logout() {
            localStorage.removeItem('auth_token');
            localStorage.removeItem('user');
            currentUser = null;
            showAuthForm();
        }

        function showMessage(text, type) {
            const existingMessage = document.querySelector('.message');
            if (existingMessage) existingMessage.remove();
            
            const message = document.createElement('div');
            message.className = `message ${type}`;
            message.textContent = text;
            
            const form = document.querySelector('#authForm, #postForm, #examForm');
            if (form) {
                form.appendChild(message);
                setTimeout(() => message.remove(), 5000);
            }
        }

        function showToast(text) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: #262626;
                color: white;
                padding: 12px 20px;
                border-radius: 25px;
                font-size: 14px;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            `;
            toast.textContent = text;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 3000);
        }
    </script>
</body>
</html>